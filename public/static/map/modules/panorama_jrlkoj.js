/**/_jsload2&&_jsload2('panorama', 'Jf.prototype.VC=ia(2,function(){this.Nb.style[mf]="";this.Hi=this.si=q;this.Vv("h");this.Vv("v");this.ae(yf,window);this.ae(zf);this.ae(Af,window);this.ae(Bf,window);this.ae(Cf,window);this.options.Gk||(this.ae("DOMMouseScroll"),this.ae("mousewheel"));this.options.Gi&&this.ae(Df);this.options.Sw&&clearInterval(this.QV);this.options.wN&&this.options.wN.call(this)});var Cj=1; function Dj(a,b){var c=a.width,d=a.height,e=180/Math.pow(2,b),f=1;J()&&(f=2);c=e/(1<c/d?d:c);f=Math.floor(b)+f;for(d=360/(2*Math.pow(2,f-2)*c);512<d;)f++,d=360/(2*Math.pow(2,f-2)*c);f>vj&&(d*=Math.pow(2,f-vj),f=vj);f<Cj&&(f=Cj);d=Math.round(d);return{rM:f,VK:d}}var Ej=5063,Fj=5062,Gj=5061,Hj=5060,vj=5,Cj=1; x.extend(Pa.prototype,{Ab:function(){this.kR();for(var a=0;a<B.Fr.length;a++)B.Fr[a](this);this.Ya!=p?"inter"===this.Le?this.KF(this.Ya):this.dispatchEvent(new N("onid_changed")):this.Kb!=p&&(this.dispatchEvent(new N("onposition_changed")),this.dispatchEvent(new N("onposition_changed_inner")));this.k.visible?this.show():this.U();this.Nf!=p&&this.dispatchEvent(new N("onvisible_poi_type_changed"),{visiblePOIType:this.Nf});var a=p,b;for(b in this.Ke)a=this.Ke[b],delete this.Ke[b],this.Ja(a);this.U()}, fu:function(a){this.Nf=a||"none";this.dispatchEvent(new N("onvisible_poi_type_changed"),{visiblePOIType:this.Nf})},Ja:function(a){this.Ke[a.kd]=a;this.dispatchEvent(new N("onadd_overlay"),{overlay:a})},Ub:function(a){delete this.Ke[a.kd];this.dispatchEvent(new N("onremove_overlay"),{overlay:a})},j1:function(a,b){var c=H("div"),d=c.style;c.className="pano_m_indoor_exit";c.title=a;c.onclick=b;d.display="none";d.zIndex=1201;c.innerHTML=\'<span style="float:right;margin-right:12px;">\\u51fa\\u53e3</span>\'; return c},i1:function(a,b){var c=H("div"),d=c.style;d.position="absolute";d.zIndex=1201;d.right=d.top="10px";d.width="17px";d.height="16px";d.background=\'url("\'+I.pa+\'st-close.png") no-repeat 50% 50%\';J()&&(d.right=d.top="0px",d.width="42.5px",d.height="40px",d.backgroundSize="25.5px 24px");d.cursor="pointer";c.title=a;c.onclick=b;d.display="none";return c},rc:function(a,b,c){"object"===typeof b&&(c=b,b=j);a!=this.Ya&&(this.xl=this.Ya,this.yl=this._position,this.Ya=a,this.KA=p,this.Le=b||"street", c=c||{qk:q},this.MJ=c.qk,"inter"===b?this.KF(a):this.dispatchEvent(new N("onid_changed")),this.w_(c))},w_:function(a){this.Kv={id:this.Yb(),pov:a.pov}},LX:function(a,b){var c,d;if(this.Kv&&a===this.Kv.id){c={};for(var e=0;e<b.length;e++)d=b[e],c[d]=this.Kv[d];this.Kv=p}return c},ta:function(a,b){a.ab(this.Kb)||(this.xl=this.Ya,this.yl=this._position,this.Kb=a,this.Ya=p,b=b||{qk:q},this.MJ=b.qk,this.dispatchEvent(new N("onposition_changed_inner")))},Nc:function(a){var b={heading:this.Ea.heading,pitch:this.Ea.pitch}; this.Ea=a;a=a=this.Ea.pitch;a>this.ck?a=this.ck:a<this.ek&&(a=this.ek);this.Ea.pitch=a;if(b.heading!=this.Ea.heading||b.pitch!=this.Ea.pitch)this.Mr=o,this.dispatchEvent(new N("onpov_changed"))},Sy:function(a){var b=this.Ea,c=a.heading-b.heading,d=a.pitch-b.pitch,e=this;new ub({Hc:30,duration:200,hc:vb.hL,va:function(a){e.Nc({heading:b.heading+a*c,pitch:b.pitch+a*d})},finish:function(){e.Nc(a)}})},Oc:function(a,b){if(a!=this.Kc){a>Me&&(a=Me);a<Ne&&(a=Ne);if(a!=this.Kc){this.Kc=a;var c=new N("onzoom_changed_inner"), b=b||{};c.Hp=b.Hp||q;this.dispatchEvent(c);(!Oa()||c.Hp)&&this.dispatchEvent(new N("onzoom_changed"))}"cssRender"===this.mr()&&this.Nc(this.Ea)}},NB:function(){if(this.D){for(var a=this.D.Mx(),b=0;b<a.length;b++)(a[b]instanceof W||a[b]instanceof nd)&&a[b].point&&this.wa.push(a[b]);this.dispatchEvent(new N("onoverlay_changed"))}},Hk:function(){this.Hl.style.visibility="hidden"},Yy:function(){this.dispatchEvent(new N("onoverlay_show"));this.Hl.style.visibility="visible"},show:function(){this.k.visible= o;this.Ed&&x.K.show(this.Ed);this.Ed&&(this.k.closeControl&&this.Af&&this.D&&this.D.Ka()===this.C)&&x.K.show(this.Af);this.nB&&this.nB.show();this.NB();this.dispatchEvent(new N("onvisible_changed"))},U:function(){this.k.visible=q;this.Ed&&x.K.U(this.Ed);this.k.closeControl&&this.Af&&x.K.U(this.Af);this.nB&&this.nB.U();this.dispatchEvent(new N("onvisible_changed"))},Ry:function(a){this.D=a;this.NB()},kR:function(){var a=H("div"),b=a.style;b.overflow="hidden";b.position="absolute";b.zIndex=1200;b.top= b.left="0px";b.height=b.width="100%";b.backgroundColor="#e5e3df";this.Ed=a;this.ci=this.Tj("1");this.bk=this.Tj("4");this.Hl=this.Tj("5");a.appendChild(this.ci);a.appendChild(this.bk);a.appendChild(this.Hl);Oa()||(this.zr=this.Tj("3"),this.zr.style.width=this.C.clientWidth+"px",this.zr.style.height=this.C.clientHeight+"px",this.zr.style.overflow="hidden",this.zr.style.WebkitUserSelect="none",a.appendChild(this.zr),We()&&(this.jw=this.xH(),this.ci.appendChild(this.jw),this.kw=this.xH(),this.ci.appendChild(this.kw))); this.C.appendChild(a);"absolute"!=Xa(this.C).position&&(this.C.style.position="relative")},Tj:function(a){var b=H("div"),c=b.style;c.position="absolute";c.top=c.left="0";c.zIndex=a||"0";c.WebkitUserSelect="none";return b},xH:function(){var a=H("img");thumbStyle=a.style;thumbStyle.position="absolute";thumbStyle.top=thumbStyle.left="0";thumbStyle.zIndex="1";thumbStyle.opacity="0";thumbStyle.hc=thumbStyle.WebkitTransition="opacity 300ms ease-out";a.onload=function(){this.style.visibility="";this.style.opacity= "1"};return a},Ka:v("C"),ih:function(){return new M(this.C.clientWidth,this.C.clientHeight)},p3:v("jk"),iY:v("mw"),vO:da("mw"),KF:function(a){a!=this.KA&&(this.KA=a,this.Ya=p,this.dispatchEvent(new N("oniid_changed")),this.dispatchEvent(new N("onid_changed")),Ra(5045,{type:this.k.panoramaRenderer}))},clear:function(){this.Kb=this.Ya=this.ea=p;this.ko=[];this.dispatchEvent(new N("onclear"))},ap:function(){var a=this.ea.jm;this.VR=this.ea.HV;this.clear();this.FH=o;this.rc(a)}});var Ij=Pa.prototype; U(Ij,{setId:Ij.rc,setPosition:Ij.ta,setPov:Ij.Nc,setZoom:Ij.Oc,show:Ij.show,hide:Ij.U,setPanoramaPOIType:Ij.fu,addOverlay:Ij.Ja,removeOverlay:Ij.Ub,exitInter:Ij.ap});function Jj(a){a.lg=this;var b=x.platform.Sm?"android":"ios";Oa()?(this.Bd=new Kj(a),this.md=new Lj(a,this.Bd.Xa),this.Bd.iV(this.md),"android"===b?Ra(Hj):Ra(Gj)):(this.Bd=new Mj(a),this.md=new Nj(a),"android"===b?Ra(Fj):Ra(Ej));a.k.linksControl?this.md.show():this.md.U();a.k.clickOnRoad?this.md.vD():this.md.$C();this.P=a;this.ca();this.LT=new Oj(a,this)}B.bn(function(a){a.lg=new Jj(a)});x.lang.ua(Jj,x.lang.Da,"PanoramaRenderer"); x.extend(Jj.prototype,{ca:function(){var a=this.P,b=this;a.addEventListener("links_visible_changed",function(){a.k.linksControl===o?b.md.show():b.md.U()});a.addEventListener("clickonroad_changed",function(){a.k.clickOnRoad===o?b.md.vD():b.md.$C()});a.addEventListener("dataload",function(c){b.ea=c.data;b.av();b.qJ(c.data);b.va(a.Fa(),b.ef,b.Zg)});a.addEventListener("pov_changed",function(){b.ea&&b.va(a.Fa(),b.ef,b.Zg)});a.addEventListener("clear",function(){b.ea=p;b.qJ(p);b.Bd.va();b.md&&b.md.va()}); a.addEventListener("zoom_changed_inner",function(c){b.ea&&(b.av(),b.BU(a.Fa(),b.ef,b.Zg,c.Hp))});a.addEventListener("size_changed",function(a){b.GB(a)});a.addEventListener("dblclick",function(){var b=a.ga();4===b?a.Oc(1):a.Oc(b+1);a.dispatchEvent(new N("ondblclickzoomend"))});a.kl=a.ih();setInterval(function(){if(a.Yb()){var c=a.ih();if(!c.ab(a.kl)){a.kl=c;var d=new N("onsize_changed");d.t4=a.kl;d.size=c;a.dispatchEvent(d);c=b.ef;b.av();c!=b.ef&&b.Bd.Bp&&b.Bd.Bp();b.va(a.Fa(),b.ef,b.Zg)}}},80);Oa()&& a.addEventListener("refresh",function(){b.Bd.as()})},GB:function(){var a=this.ef;this.av();a!=this.ef&&this.Bd.Bp&&this.Bd.Bp();this.Bd.Qk&&this.Bd.Qk();this.md.Qk&&this.md.Qk();a=this.P;this.va(a.Fa(),this.ef,this.Zg);"cssRender"===a.mr()&&a.Nc(a.Fa())},qJ:function(a){a&&("number"===typeof a.heading&&this.P.Mr===q)&&(this.P.Ea.heading=a.heading,this.P.Ea.pitch=a.pitch);var b=this.P.LX(a&&a.id,["pov"]);b&&b.pov&&(this.P.Ea.heading=b.pov.heading,this.P.Ea.pitch=b.pov.pitch);if(this.P.FH&&a.indoorPois){for(var b= p,c=this.P.VR,d=0,e=a.indoorPois.length;d<e;d++)c==a.indoorPois[d].panoIId&&(b=a.indoorPois[d]);b&&(this.P.Ea.heading=Re(b.pointX-a.wh,b.pointY-a.xh),this.P.Ea.pitch=0);this.P.FH=q;this.P.p1=p}this.P.Mr&&(this.P.Mr=q);this.P.kt();a&&a.jm?this.P.Uy("inter"):this.P.Uy("street");this.Bd.setData(a,this.kE(),this.ef);this.md.setData(a)},BU:function(a,b,c,d){var e=this;this.Bd.Oc(e.kE(),e.ef,{Hp:d,NZ:function(a){e.LT.Or(a)}});"cvsRender"!=this.P.jk&&this.Bd.va(a,b,c);this.md.va(a,b,c)},va:function(a,b, c){this.Bd.va(a,b,c);this.md.va(a,b,c)},f3:v("ef"),kE:function(){return this.P.ga()},W2:v("Zg"),av:function(){var a=Dj(this.P.ih(),this.P.ga());this.Zg=a.VK;this.ef=a.rM}});function Pj(a){this.P=a}B.bn(function(a){var b=new Pj(a);a.addEventListener("dataload",function(a){b.ea=a.data;b.Vi()});a.addEventListener("zoom_changed_inner",function(){b.nb&&(b.nb.stop(),b.nb=p)})}); Pj.prototype.Vi=function(){function a(a,b){A.lg.Bd.Tg||(g=o,P.nb&&P.nb.stop(),i=a,k=b,C=A.Fa().heading,F=A.Fa().pitch,A.dispatchEvent(new N("ontouchstart")))}function b(a,b){g&&!A.Tl&&(y=o,P.XA||(P.XA=o,P.n1=cb()),e(a,b),n=l-a,s=m-b,l=a,m=b,P.wI=cb())}function c(a){g&&(g=q,!y&&(!D&&S)&&P.tH&&(P.tH=q,P.bo?(P.Si&&(clearTimeout(P.Si),P.Si=p),10>i-P.bo.x&&10>k-P.bo.y&&A.dispatchEvent(new N("ondblclick")),P.bo=p):(P.bo={x:i,y:k},P.Si=setTimeout(function(){var a,b,c=A.bB;a=A.Ed;var d=0;for(b=0;a.offsetParent;)d+= a.offsetLeft,b+=a.offsetTop,a=a.offsetParent;a=i-d;b=k-b;Oa()&&(a*=2,b*=2);0===c.eM(a,b)&&A.dispatchEvent(new N("onclick"));P.bo=p},400))),P.XA=q,d(a),D=y=q)}function d(a){if(a){var b=cb()-P.wI;if(!(100<b||10<b&&10>Math.abs(n)&&10>Math.abs(s))){var c;J()?(b=a.changedTouches[0].clientX,c=a.changedTouches[0].clientY):(b=a.clientX,c=a.clientY);a=new R(i,k);c=new R(b,c);var b=[0<c.x-a.x?1:-1,0<c.y-a.y?1:-1],d=Math.abs(a.x-c.x),f=0,g=0;0==Math.abs(a.y-c.y)?f=d:(a=Math.abs(a.x-c.x)/Math.abs(a.y-c.y),g= Math.round(Math.sqrt(24336/(1+a*a))),f=Math.round(a*g));-1==b[0]&&(f=-f);-1==b[1]&&(g=-g);P.nb&&P.nb.stop();C=A.Fa().heading;F=A.Fa().pitch;P.nb=new ub({duration:625,Hc:60,hc:function(a){return a*0.3125-0.15625*a*a},va:function(a){a=a*6.4;e(a*f,a*g)},finish:function(){P.nb=p},Pt:function(){P.nb=p}})}}}function e(a,b){u=-a*P.Vu;w=b*P.Vu;var c=C+u,d=F+w;d>A.ck&&(d=A.ck);d<A.ek&&(d=A.ek);A.Nc({heading:c,pitch:d})}function f(a){if(A.k.enableScrollWheelZoom){var a=window.event||a,b=new N("onmousewheel"); b.iq=0<=a.wheelDelta||0>a.detail;var c=new Date;if(!(220>c-ba)&&(ba=c,"path"!=(a.srcElement||a.target).tagName)){var c=ma(b,a),d=a.srcElement||a.target,e=a.offsetX||a.layerX||0,f=a.offsetY||a.layerY||0;1!=d.nodeType&&(d=d.parentNode);for(;d&&d!=A.Ka();){d.ba&&(x.lang.Lc(d.ba)instanceof ib&&(overlay=x.lang.Lc(d.ba)),x.lang.Lc(d.ba)instanceof md&&(infoWindow=x.lang.Lc(d.ba)));if(!(0==d.clientWidth&&0==d.clientHeight&&d.offsetParent&&"TD"==d.offsetParent.nodeName)&&"http://www.w3.org/2000/svg"!=d.namespaceURI)e+= d.offsetLeft||0,f+=d.offsetTop||0;else if("http://www.w3.org/2000/svg"==d.namespaceURI){var g=A.lg.md&&A.lg.md.hf||p;if(-1<navigator.userAgent.indexOf("Opera")&&"svg"!=d.tagName){if(d=x.lang.Lc(d.ba))d=d.Kd(),e+=P.Cc(d.xe()).x,f+=P.Cc(d.pf()).y;break}if(g&&(!x.da.ma||9<=x.da.ma&&"svg"==d.nodeName.toLowerCase()))e+=parseInt(g.style.left),f+=parseInt(g.style.top)}d=d.offsetParent}c.x=e;c.y=f;A.ga();A.Fa();A.Fa();var i;if(b.iq==o){if(A.ga()==Me){Db(a);return}i=A.ga()+2/3}else if(b.iq==q){if(A.ga()== Ne){Db(a);return}i=A.ga()-2/3}A.Oc(i)}Db(a)}}if(!this.dT){this.dT=o;var g=q,i,k,l=0,m=0,n,s,u=0,w=0,y=q,D=q,C,F,z,A=this.P,E=q,G=0;this.Vu=Qj(this);this.wI=0;this.XA=q;this.bo=p;this.ng=1;var P=this,S=q;J()?(x.M(A.Ed,"touchstart",function(b){S=o;for(var c=b.target;c&&c!=A.Ed;){if(c===A.Hl){S=q;break}c=c.offsetParent}P.tH=o;var c=b.touches[0].clientX,d=b.touches[0].clientY,e=A.bB;if(Oa())e&&e.WH(b.touches[0].pageX*e.kg,b.touches[0].pageY*e.kg)!=p&&(S=q);else if(!Nb()&&e){var f=Cb(A.Ed);-1!=e.OL(c- f.left,d-f.top)&&(S=q)}a(c,d);(!x.platform.Sm||-1==navigator.userAgent.indexOf("QQBrowser"))&&b.preventDefault();b.stopPropagation()}),x.M(A.Ed,"touchmove",function(a){if(!E){b(a.touches[0].clientX-i,a.touches[0].clientY-k);var c=new N("ontouchmove");c.a5=new R(a.touches[0].pageX,a.touches[0].pageY);A.dispatchEvent(c)}a.preventDefault();a.stopPropagation()}),x.M(document,"touchend",function(a){c(a);S=q}),A.Ed.addEventListener("gesturestart",function(){G=A.ga()},q),A.Ed.addEventListener("gesturechange", function(a){P.ng=a.scale;D=E=o;a=P.ng*G;4<a?a=4:1>a&&(a=1);a=Math.round(100*a)/100;A.Oc(a,{Hp:o})},q),A.Ed.addEventListener("gestureend",function(){E=q;A.ga()!=G&&A.dispatchEvent(new N("onpinchtozoomend"))},q)):(x.M(A.Ed,"mousedown",function(b){a(b.clientX||b.pageX||0,b.clientY||b.pageY||0);z=b.target||b.srcElement;x.da.ma&&z.setCapture&&z.setCapture();P.ZT=A.Ed.style.cursor;A.Ed.style.cursor=I.Id;x.da.ma||Db(b)}),x.M(document,"mousemove",function(a){b((a.clientX||a.pageX||0)-i,(a.clientY||a.pageY|| 0)-k);oa(a)}),x.M(document,"mouseup",function(a){na(a);c(a);x.da.ma&&(z&&z.releaseCapture)&&z.releaseCapture();A.Ed.style.cursor=P.ZT||I.Xb}));A.addEventListener("zoom_changed_inner",function(){P.Vu=Qj(P)});A.addEventListener("size_changed",function(){P.Vu=Qj(P)});var ba=new Date;x.M(A.Ka(),"mousewheel",f);window.addEventListener&&A.Ka().addEventListener("DOMMouseScroll",f,q)}}; function Qj(a){if(!a.ea)return p;var b=a.P,c=Dj(b.ih(),b.ga()),d=c.rM,c=c.VK;if("cssRender"===b.mr()&&!Oa())return 360/(a.ea.tiles.op(d)*c);b=a.P.ga();return 180/Math.pow(2,b)/a.P.ih().height};function Oj(a,b){x.lang.Da.call(this);this.P=a;this.Ba=b;this.Vh=[];this.Xh={};this.tB=q;this.Qz()}x.lang.ua(Oj,x.lang.Da,"PanoramaOverlayMgr"); x.extend(Oj.prototype,{Qz:function(){var a=this,b=this.P;b.addEventListener("add_overlay",function(c){c=c.overlay;c.ra(b);a.Vh.push(c);a.Qr()});b.addEventListener("dataload",function(){a.tB=o;a.Qr()});b.addEventListener("remove_overlay",function(b){for(var b=b.overlay,d=0,e=a.Vh.length;d<e;d++)b==a.Vh[d]&&a.Vh.splice(d,1);b.remove();a.Qr()});b.addEventListener("clear",function(){a.tB=q});b.addEventListener("zoom_changed",function(){a.Or()});b.addEventListener("dataload",function(){a.Qr()});b.addEventListener("pov_changed", function(){a.Or()});b.addEventListener("size_changed",function(){a.Or()});b.addEventListener("onoverlay_property_changed",function(){a.Qr()})},Qr:function(){this.eU();if(0!=this.Vh.length&&this.tB){for(var a,b,c,d=this.Vh.length-1;0<=d;d--)if(b=this.Vh[d],ovarlayDom=b.Ld(),c=b.Fa())a=c.heading,b.dP(),b=b.kd,this.Xh[a]||(this.Xh[a]={}),this.Xh[a][b]={dom:ovarlayDom,pov:c},this.P.Hl.appendChild(ovarlayDom);this.Or()}},Or:function(a){this.P.Fa();var a=a||this.Ba.ef,b=this.Ba.Zg,c=function(){function a(c){var d= b[c.top];if(!d)return q;for(var e=d.length-1;0<=e;e--)if(c.left>=d[e].left&&c.left<=d[e].right||c.right>=d[e].left&&c.right<=d[e].right)return o;return q}var b={};return function(c){for(;a(c);)c.top+=-36;b[c.top]?b[c.top].push(c):b[c.top]=[c];return c}}(),d;for(d in this.Xh)for(var e in this.Xh[d]){var f=this.Xh[d][e],g=this.QT(d,f.pov.pitch,a,b),f=f.dom,g=c({top:g[1],left:g[0],right:g[0]+f.offsetWidth});f.style.left=g.left-f.offsetWidth/2+"px";f.style.top=g.top+f.offsetHeight/2+"px"}},QT:function(a, b,c,d){if(Oa())return this.RT(a,b);var e=this.P;for(svHeading=e.Fa().heading%360;0>svHeading;)svHeading=(svHeading+360)%360;var f=(a-svHeading)%360,a=e.ih(),c=360/(2*Math.pow(2,c-2)*d);180<f?f-=360:-180>f&&(f+=360);d=Math.round(a.width/2+f/c);b=Math.round(a.height/2-(b-e.Fa().pitch)/c);return[d,b]},RT:function(a,b){var c=500*Math.cos(Pb(b)),c=Math.round(100*c)/100;"string"==typeof a&&(a=parseFloat(a));var d;d=a+this.P.ea.tiles.dirNorth;d%=360;var e=this.P.lg.Bd;d=Rj.tg(Math.cos(Pb(d))*c,500*Math.sin(Pb(b)), Math.sin(Pb(d))*c,1);var c=Rj.create(),f=e.Wh;Sj.multiply(c,e.If[0],d);Sj.multiply(c,f,c);if(0>c[3])return[-1E3,-1E3];e=this.P.kl;return[(c[0]/c[3]+1)/2*e.width,(1-c[1]/c[3])/2*e.height]},eU:function(){for(var a in this.Xh)for(var b in this.Xh[a]){var c=this.Xh[a][b].dom;c.parentNode.removeChild(c)}this.Xh={}}});x.extend(Qe.prototype,{ra:function(a){this.P=a;this.ia()||this.ta(this.P.ia());this.gA();this.Oz()},Ld:v("ed"),hide:function(){this.Pa=q;this.ed&&(this.ed.style.display="none")},show:function(){this.Pa=o;this.ed&&(this.ed.style.display="block")},isVisible:v("Pa"),dP:function(){var a=this.co();100<a?(a/=1E3,a=100>a?a.toFixed(2):a.toFixed(0),a+="\\u516c\\u91cc"):(a=100>a?a.toFixed(2):a.toFixed(0),a+="\\u7c73");this.Vq.innerHTML=a},gA:function(){var a=this.Bk(),b=H("div"),c=b.style;c.position="absolute"; c.backgroundColor="rgba(29, 29, 29, 0.8)";c.padding="7px 0";c.height="19px";c.font="16px arial";c.color="white";c.whiteSpace="nowrap";c.borderRadius="4px";c.left="-1000px";c.top="-1000px";c=H("div");c.style["float"]="left";c.style.lineHeight="19px";b.appendChild(c);var d=H("span");d.style.margin="0 14px";d.innerHTML=a;c.appendChild(d);a=H("span");a.style.color="color:rgba(255,255,255,0.3)";a.innerHTML="|";c.appendChild(a);var e=H("span");e.style.margin="0 8px";e.style.color="#60c7fa";e.style.fontSize= "12px";e.innerHTML="0\\u7c73";c.appendChild(e);this.AR===q&&(e.style.display="none",a.style.display="none");this.ed=b;this.Vq=e;this.gs=d},Oz:function(){var a=this;this.bR(this.ed,function(b){a.dispatchEvent(new N("onclick"),{type:"click",target:a});Db(b)});x.M(this.ed,"mouseenter",function(){a.dispatchEvent(new N("onmouseover"),{type:"mouseover",target:a})});x.M(this.ed,"mouseleave",function(){a.dispatchEvent(new N("onmouseout"),{type:"mouseout",target:a})})},bR:function(a,b){if(J()){var c=0,d=0, e=0;a.addEventListener("touchstart",function(a){c=(new Date).getTime();d=a.touches[0].pageX;e=a.touches[0].pageY},q);a.addEventListener("touchend",function(a){200<=(new Date).getTime()-c||(5<=Math.abs(a.changedTouches[0].pageX-d)||5<=Math.abs(a.changedTouches[0].pageY-e))||b.call(this,a)},q)}else x.M(this.ed,"click",b)},Mf:function(a,b){this.ed&&("content"===a&&(this.gs.innerHTML=b),this.P.dispatchEvent(new N("onoverlay_property_changed")))},remove:function(){this.ed=this.Vq=this.gs=p;this.dispatchEvent(new N("onremove"), {type:"remove",target:this})}});x.extend(Te.prototype,{ra:function(a){this.P=a;this.gA();(a=this.iE())&&(a.panoId||a.panoIId)&&this.Oz(a)},Ld:v("ed"),hide:function(){this.Pa=q;this.ed.style.display="none"},show:function(){this.Pa=o;this.ed.style.display="block"},isVisible:v("Pa"),dP:function(){var a=this.P.ia(),b=this.ia(),a=T.fp(a,b);100<a?(a/=1E3,a=100>a?a.toFixed(2):a.toFixed(0),a+="\\u516c\\u91cc"):(a=100>a?a.toFixed(2):a.toFixed(0),a+="\\u7c73");this.Vq.innerHTML=a},Oz:function(a){var b=this;if(a.panoIId){var c=function(c){b.P.KF(a.panoIId); c.stopPropagation();c.preventDefault()};J()?x.M(this.nr,"touchend",function(a){c(a)}):(this.nr.style.cursor="pointer",x.M(this.nr,"click",function(a){c(a)}))}if(a.panoId){var d=function(c){function d(){b.P.Nc(b.Fa());b.P.removeEventListener("dataload",d)}var g=a.panoId;b.P.Yb()!=g&&(b.P.rc(g),b.P.addEventListener("dataload",d));c.stopPropagation();c.preventDefault()};x.M(this.ed,"touchend",function(a){d(a)});this.ed.style.cursor="pointer";x.M(this.ed,"click",function(a){d(a)})}},gA:function(){var a= this.np(),b=H("div"),c=b.style;c.position="absolute";c.backgroundColor="rgba(29, 29, 29, 0.8)";c.padding="7px 0";c.height="19px";c.font="16px arial";c.color="white";c.whiteSpace="nowrap";c.borderRadius="4px";c.left="-1000px";c.top="-1000px";var d=H("img");d.src=this.gp();d.style.width="24px";d.style.height="24px";d.style.position="absolute";d.style.left="5px";d.style.top="5px";c.paddingLeft="40px";b.appendChild(d);c=H("div");c.style["float"]="left";c.style.lineHeight="19px";b.appendChild(c);var e= H("span");e.style.margin="0 14px";e.innerHTML=a;c.appendChild(e);a=H("span");a.style.color="color:rgba(255,255,255,0.3)";a.innerHTML="|";c.appendChild(a);a=H("span");a.style.margin="0 8px";a.style.color="#60c7fa";a.style.fontSize="12px";a.innerHTML="0\\u7c73";c.appendChild(a);this.ed=b;this.nr=d;this.Vq=a;this.gs=e},Mf:function(a,b){switch(a){case "title":this.gs.innerHTML=b;break;case "altitude":this.P.dispatchEvent(new N("onoverlay_position_changed"));break;case "position":this.P.dispatchEvent(new N("onoverlay_position_changed"))}}, remove:function(){this.gs=this.Vq=this.nr=this.ed=p;this.dispatchEvent(new N("onremove"),{type:"remove",target:this})}});x.extend(function(a){this.Vi(a)}.prototype,{Vi:function(a){this.P=a;this.Eo=this.Do=o;this.Ba();this.ca()},Ba:function(){this.C=H("div");var a=this.C.style;a.position="absolute";a.left="10px";a.top="10px";a.zIndex=1201;a=this.C;a.innerHTML=this.fr();Va()?(this.ld=x.$(a.children[2]),this.po=[x.$(this.ld.children[0]),x.$(this.ld.children[1]),x.$(this.ld.children[2]),x.$(this.ld.children[3])],Nb()?this.DJ=x.$(a.children[1].childNodes[0]):Mb()&&(this.OJ=x.$(a.children[1].childNodes[0])),this.ce=x.$(a.children[3])): J()&&(this.ce=x.$(a.children[0]));this.Hh=x.$(this.ce.children[0]);this.cg=x.$(this.ce.children[1]);x.da.ma&&(this.ld.style.background=\'url("\'+I.pa+\'blank.gif") repeat\');6==x.da.ma&&this.pU();J()&&(this.ce.style.left=this.ce.style.top="0",this.ce.style.width="36px",this.ce.style.height="78px",this.Hh.style.width=this.cg.style.width="33px",this.Hh.style.height=this.cg.style.height="36px",this.cg.style.top="37.5px");this.P.ga()==Me&&this.uo("zoomIn",q);this.P.ga()==Ne&&this.uo("zoomOut",q);this.P.Ka().appendChild(a)}, fr:function(){var a=[];Va()&&(a.push(this.tA()),a.push(this.fS()),a.push(this.hS()));a.push(this.uA());return a.join("")},fS:function(){if(Nb())return\'<svg version="1.1" overflow="hidden" width="82px" height="82px" viewBox="0 0 82 82" style="position: absolute; top: 0px; left: 0px;"><g transform="rotate(0, 41, 41)"><rect x="33" y="1" width="14" height="12" rx="4" ry="4" stroke="#868685" stroke-width="1" fill="#f8f8f8"></rect><polyline points="37.5,9.5 37.5,3.5 42.5,9.5 42.5,3.5" stroke-linejoin="bevel" stroke-width="1.5" fill="#f2f4f6" stroke="#868685"></polyline></g></svg>\'; if(Mb())return\'<div style="position:absolute;top:0;left:0;z-index:0"><v:group style="position:absolute;width:82px;height:82px; behavior:url(#default#VML);rotation:0" unselectable="on" coordsize="82,82" coordorigin="-41,-41"><v:roundrect style="width:14px;height:12px;top:-40px; behavior:url(#default#VML);left:-7px;z-index:2" fillcolor="#f8f8f8" arcsize ="19661f" coordsize="21600,21600" strokecolor="#868685" strokeweight="1pt"></v:roundrect><v:polyline style="behavior: url(#default#VML);z-index:3" fillcolor="#f2f4f6" points="-3,-31,-3,-37,3,-31,3,-37" strokeweight="1.2pt"><v:stroke style="behavior:url(#default#VML)" color="#868685" joinstyle="bevel"></v:stroke></v:polyline></v:group></div>\'}, tA:function(){return\'<div style="position:absolute;top:4px;left:4px;width:74px;height:74px;background:url(\'+I.pa+\'st-navictrl.png) no-repeat;-webkit-user-select:none;overflow:hidden"><div></div></div>\'},hS:function(){return\'<div style="position:absolute;top:0px;left:0;width:82px;height:82px;-webkit-user-select:none;cursor:\'+I.Xb+\'"><div style="position:absolute;left:32px;top:13px;cursor:pointer;width:17px;height:17px;" title="\\u5411\\u4e0a\\u5e73\\u79fb"></div><div style="position:absolute;left:14px;top:32px;cursor:pointer;width:17px;height:17px;" title="\\u5411\\u5de6\\u5e73\\u79fb"></div><div style="position:absolute;left:51px;top:32px;cursor:pointer;width:17px;height:17px;" title="\\u5411\\u53f3\\u5e73\\u79fb"></div><div style="position:absolute;left:33px;top:51px;cursor:pointer;width:17px;height:17px;" title="\\u5411\\u4e0b\\u5e73\\u79fb"></div></div>\'}, uA:function(){var a="background-image:url(\'"+I.pa+"st-navictrl.png\');background-repeat:no-repeat;background-position:-74px 0;";J()&&(a="background-image:url(\'"+I.pa+"st-navictrl-hd.png\');background-repeat:no-repeat;background-position:0 0;background-size:180px 78px;");return\'<div style="position:absolute;top:84px;left:30px;width:24px;height:52px;\'+a+\'-webkit-user-select:none;overflow:hidden"><div style="position:absolute;cursor:pointer;width:22px;height:24px;top:0;left:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)" title="\\u653e\\u5927\\u4e00\\u7ea7"></div><div style="position:absolute;cursor:pointer;width:22px;height:24px;top:25px;left:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)" title="\\u7f29\\u5c0f\\u4e00\\u7ea7"></div><div></div></div>\'}, ca:function(){var a=this.P,b=this;if(Va()){x.M(this.po[0],"click",function(){var b=a.Fa();a.Sy({heading:b.heading,pitch:b.pitch+30})});x.M(this.po[1],"click",function(){var b=a.Fa();a.Sy({heading:b.heading-45,pitch:b.pitch})});x.M(this.po[2],"click",function(){var b=a.Fa();a.Sy({heading:b.heading+45,pitch:b.pitch})});x.M(this.po[3],"click",function(){var b=a.Fa();a.Sy({heading:b.heading,pitch:b.pitch-30})});for(var c=0;c<this.po.length;c++)x.M(this.po[c],"mousedown",na);b.Jv=q;x.M(this.ld,"mousedown", function(c){b.Jv=o;b.ld.style.cursor=I.Id;x.da.ma&&b.ld.setCapture&&b.ld.setCapture();b.BJ=b.kH(c);b.vR=a.Fa().heading;x.da.ma||Db(c)});x.M(document,"mousemove",function(c){b.Jv&&a.Nc({heading:b.vR+360-(b.kH(c)-b.BJ),pitch:a.Fa().pitch})});x.M(document,"mouseup",function(){b.Jv&&(b.Jv=q,b.ld.style.cursor=I.Xb,x.da.ma&&b.ld.releaseCapture&&b.ld.releaseCapture(),b.BJ=p)});a.addEventListener("position_changed",function(){var c=360-this.Fa().heading;Nb()?b.DJ.setAttribute("transform","rotate("+c+", 41, 41)"): Mb()&&(b.OJ.style.rotation=c);a.removeEventListener("position_changed",arguments.callee)});a.addEventListener("pov_changed",function(){var a=360-this.Fa().heading;Nb()?b.DJ.setAttribute("transform","rotate("+a+", 41, 41)"):Mb()&&(b.OJ.style.rotation=a)})}x.M(this.C,"mousemove",function(){a.dispatchEvent(new N("hide_ellipse"))});x.M(this.C,"mouseout",function(){a.dispatchEvent(new N("show_ellipse"))});x.M(this.Hh,"click",function(){a.Oc(a.ga()+1)});x.M(this.cg,"click",function(){a.Oc(a.ga()-1)});Va()? (x.M(this.Hh,"mousedown",function(){b.ik(b.Do,-98)}),x.M(this.cg,"mousedown",function(){b.ik(b.Eo,-122)}),x.M(this.Hh,"mouseup",function(){b.ik(b.Do,-74)}),x.M(this.cg,"mouseup",function(){b.ik(b.Eo,-74)})):J()&&(x.M(this.Hh,"touchstart",function(){b.ik(b.Do,-98)}),x.M(this.cg,"touchstart",function(){b.ik(b.Eo,-122)}),x.M(this.Hh,"touchend",function(){b.ik(b.Do,-74)}),x.M(this.cg,"touchend",function(){b.ik(b.Eo,-74)}));this.P.addEventListener("zoom_changed_inner",function(){if(this.ga()==Me)b.uo("zoomIn", q);else if(this.ga()==Ne)b.uo("zoomOut",q);else{b.uo("zoomIn",o);b.uo("zoomOut",o)}})},ik:function(a,b){a&&(6==x.da.ma?this.ce.children[2].style.left=b+"px":(J()&&(b=36*((b+74)/24)),this.ce.style.backgroundPosition=b+"px 0"))},pU:function(){var a=this.C.children[0];a.style.background="";a.children[0].style.cssText+="position:absolute;left:0;top:0;width:98px;height:74px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\'"+I.pa+"st-navictrl.png\')";this.ce.style.background="";this.ce.children[2].style.cssText+= "position:absolute;z-index:-1;left:-74px;top:0;width:98px;height:74px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\'"+I.pa+"st-navictrl.png\')"},show:function(){this.C.style.display=""},U:function(){this.C.style.display="none"},kH:function(a){var a=window.event||a,b=a.pageX||a.clientX,a=a.pageY||a.clientY,c=Cb(this.P.Ka()),b=b-c.left-50,a=-(a-c.top-50),b=180*(Math.atan2(a,b)/Math.PI);return 90>b?90-b:450-b},uo:function(a,b){var c=this.ce.children[2];if("zoomIn"==a)if(b)if(this.Do= o,this.Hh.style.cursor="pointer",6==x.da.ma)c.style.left="-74px";else{var d=-74;J()&&(d=0);this.ce.style.backgroundPosition=d+"px 0"}else this.Do=q,this.Hh.style.cursor="",6==x.da.ma?c.style.left="-170px":(d=-170,J()&&(d=-144),this.ce.style.backgroundPosition=d+"px 0");"zoomOut"==a&&(b?(this.Eo=o,this.cg.style.cursor="pointer",6==x.da.ma?c.style.left="-74px":(d=-74,J()&&(d=0),this.ce.style.backgroundPosition=d+"px 0")):(this.Eo=q,this.cg.style.cursor="",6==x.da.ma?c.style.left="-146px":(d=-146,J()&& (d=-108),this.ce.style.backgroundPosition=d+"px 0")))}});function Tj(a,b){this.RB=a;this.$e=[];this.nc={Po:p};var b=b||{},c;for(c in b)this.nc[c]=b[c]}Tj.prototype.setData=function(a,b){if(0!==this.RB){if(this.$e.length>this.RB){for(var c=Math.round(0.6*this.RB),d=0;d<c;d++){var e=this.$e[d].vI;this.nc.Po&&this.nc.Po(this.$e[e]);delete this.$e[e]}this.$e.splice(0,c)}this.$e[a]||this.$e.push(b);this.$e[a]=b;b.vI=a}};Tj.prototype.getData=function(a){return this.$e[a]}; Tj.prototype.clear=function(){for(var a=0;a<this.$e.length;a++){var b=this.$e[a].vI;this.nc.Po&&this.nc.Po(this.$e[b]);delete this.$e[b]}this.$e=[]};function Uj(){this.dA=0;this.Pg={}}Uj.prototype.Dx=function(){var a=p,b;for(b in this.Pg)if(this.Pg[b]&&this.Pg[b].sA===o)return this.Pg[b].sA=q,this.Pg[b];a=new Image;this.dA++;b="img_"+this.dA;return this.Pg[b]=a};Uj.prototype.clear=function(){for(var a in this.Pg)this.Pg[a]&&(this.Pg[a].onload=this.Pg[a].onerror=p);this.Pg={};this.dA=0};function Mj(a){this.P=a;return"cvsRender"==a.jk?new Vj(a):new Wj(a)};function Vj(a){this.P=a;this.ci=a.ci;this.Tj();this.P.sa=this;this.ca()} x.extend(Vj.prototype,{ca:function(){var a=this,b=a.P;b.addEventListener("size_changed",function(c){a.Ce(b.lg.ef,b.lg.kE(),c.size)})},setData:function(a,b,c){a&&(this.ea=a,this.nT(b,c))},Tj:function(){var a=H("canvas");a.width=this.P.Ka().clientWidth;a.height=this.P.Ka().clientHeight;var b=a.style;b.position="absolute";b.left=b.top="0";this.ci.appendChild(a);this.NV=a.getContext("2d");this.Bi=[];this.jK=[];this.Vc=new Xj(this.NV,this.Bi,0,a.width,a.height,this.P);for(a=b=a=0;16>a;a++){this.Bi[a]= [];for(b=0;8>b;b++){var c=new Yj(this.P);c.XM=a;c.YM=b;c.canvas=this.Vc;this.Bi[a][b]=c}}this.P.d2=this.Vc},va:function(a,b){if(a&&b){var c=a.heading%360,d=a.pitch;this.EA({heading:c,pitch:d},b);this.Vc.ni({heading:c,pitch:d},b)}},nT:function(a,b){this.Vc.tW();this.iS(this.ea);this.Vc.oY(this.ea);this.iJ(a,b);this.CA(b,o)},Oc:function(a,b){var c=this,d=o;b==this.Vc.sa.zoom&&(d=q);this.iJ(a,b);d&&this.CA(b,o);setTimeout(function(){c.EA()},1E3)},iS:function(a){var b=this,c=a.tiles,d={ye:[]};d.ye[0]= new Image;d.ye[0].src=c.getTilesUrl(a.id,{x:0,y:0},2);d.ye[1]=new Image;d.ye[1].src=c.getTilesUrl(a.id,{x:1,y:0},2);b.pP=0;d.ye[0].onload=function(){b.my()};d.ye[1].onload=function(){b.my()};this.jK[0]=d},my:function(){this.pP++;2==this.pP&&(this.Vc.C_(this.jK[0].ye),this.Vc.my())},EA:function(a,b){if(this.ea&&this.ea.tiles)for(var c=this.ea.tiles,d=[],b=b||this.Vc.sa.zoom,d=this.Bi,e=this.Vc.UD(a),f=e.Du,g=e.Ms,i=e.Ht,e=e.Yt,e=e>i?e-i:64+e-i,k=0,l=0,m=0;m<e+Math.pow(2,7-b);){for(var n=f;n<g+Math.pow(2, 7-b);){k=m+i;63<k?k%=64:0>k&&(k+=64);k=Math.floor(k*Math.pow(2,b-7));l=Math.floor(n*Math.pow(2,b-7));if(k<Math.pow(2,b-1)&&l<Math.pow(2,b-2)&&0==d[k][l].um){var s=c.getTilesUrl(this.ea.id,{x:k,y:l},b);d[k][l].wO(s)}n+=Math.pow(2,7-b)}m+=Math.pow(2,7-b)}},CA:function(a,b){var c=q;b&&(c=o);if(!c)if(this.oz)this.oz=q;else return;if(this.ea&&this.ea.tiles){for(var c=this.ea.tiles,d=[],e=Math.pow(2,a-1),f=Math.pow(2,a-2),d=this.Bi,g=0;g<e;g++)for(var i=0;i<f;i++)d[g][i].RZ();for(var g=this.Vc.UD(),e=g.Du, f=g.Ms,k=g.Ht,g=g.Yt,l=g>k?g-k:64+g-k,m=0,n=0,g=0;g<l+Math.pow(2,7-a);){for(i=e;i<f+Math.pow(2,7-a);){m=g+k;63<m?m%=64:0>m&&(m+=64);m=Math.floor(m*Math.pow(2,a-7));n=Math.floor(i*Math.pow(2,a-7));if(m<Math.pow(2,a-1)&&n<Math.pow(2,a-2)){var s=c.getTilesUrl(this.ea.id,{x:m,y:n},a);d[m][n].wO(s)}i+=Math.pow(2,7-a)}g+=Math.pow(2,7-a)}}},Ce:function(a,b,c){a!=this.Vc.sa.zoom&&(this.oz=o);this.Vc.Qk(a,b,c);this.CA(a);this.EA();this.Vc.refresh()},iJ:function(a,b){var c=q;b==this.Vc.sa.zoom?this.oz=q:(this.oz= o,b<this.Vc.sa.zoom&&(c=o));this.Vc.SZ(a,b);return c},QX:function(a){return this.Vc.SX(a)},XD:function(a,b){return this.Vc.XD(a,b)},s3:function(){return this.Vc.sa.Ca}}); function Yj(a){this.ye=new Image;this.src="";this.canvas=p;this.YM=this.XM=this.um=0;this.P=a;var b=this;this.qM=function(){-1!=b.src.indexOf("pos=0_0&z=1")&&b.P.dispatchEvent(new N("onthumbnail_complete"));b.um=2;b.canvas.NW(b.XM,b.YM)};this.ye.onload=this.qM;this.wO=function(a){this.src==a?0==this.um&&b.qM():(this.src=this.ye.src=a,this.um=1)};this.RZ=function(){this.src=this.ye.src="";this.um=0}} function Xj(a,b,c,d,e,f){this.heading=this.pitch=0;this.zoom=2;this.Bi=b;this.Pk=[];this.rg=a;this.dm=q;this.sa={a:d,bb:e,Pf:0,qs:0,Ca:0,X0:512,heading:0,pitch:0,dd:32,zoom:0,Tp:0,Lo:0,jq:0,Y1:0,an:0,Z1:0,gq:0,Ut:0};this.P=f;this.yt=q;this.nQ()} x.extend(Xj.prototype,{nQ:function(){if(x.da.Tw){var a=navigator.userAgent.substr(navigator.userAgent.indexOf("Chrome"),12);27<Number(/[1-9][0-9]*/.exec(a+"1")[0])?(this.sa.Lo=0.0078125,this.sa.Ut=2):(this.sa.Lo=0.015625,this.sa.Ut=4);this.sa.an=0;this.sa.gq=0}else x.da.ma?(this.sa.Lo=0.0078125,this.sa.an=0,this.sa.gq=6):(this.sa.Lo=0.0078125,this.sa.an=0,this.sa.gq=4),this.sa.Ut=2},C_:da("Pk"),Bx:function(){var a=this.sa,b=Math.PI/Math.pow(2,this.sa.Tp);b>Math.PI/2+0.1&&(b=2*Math.PI/3);return a.a/ 2/Math.tan(b/2)},Qk:function(a,b,c){var d=this.sa;d.a=c.width;d.bb=c.height;this.rg.canvas.width=c.width;this.rg.canvas.height=c.height;d.zoom=a;d.Tp=b;d.Ca=this.Bx();d.dd=16*Math.pow(2,a-2);d.Vt=Math.pow(2,a-1);d.gn=Math.pow(2,a-2);d.Np=Math.pow(2,7-a)},SZ:function(a,b){var c=this.sa;if(0==this.sa.Ca)c.zoom=b,c.Tp=a,c.Ca=this.Bx(),c.dd=16*Math.pow(2,b-2),c.Vt=Math.pow(2,b-1),c.gn=Math.pow(2,b-2),c.Np=Math.pow(2,7-b),c.jq=c.Lo*Math.pow(2,-a);else if(!(a==c.Tp&&b==c.zoom)){this.dm=o;var d=this.sa.Ca; c.dd=16*Math.pow(2,b-2);c.zoom=b;c.Tp=a;c.Vt=Math.pow(2,b-1);c.gn=Math.pow(2,b-2);c.Np=Math.pow(2,7-b);d=(this.Bx()-d)/32;this.P.Hk();this.UJ(0,d);c.jq=c.Lo*Math.pow(2,-a)}},oY:function(a){this.sa.heading-=this.sa.Pf/180*Math.PI;this.sa.Pf=a.tiles.dirNorth;this.sa.heading+=a.tiles.dirNorth/180*Math.PI;this.sa.qs=a.tiles.pitch||0},UJ:function(a,b){var c=this;if(5>a)this.sa.Ca+=b*Math.pow(2,a),this.RR(),setTimeout(function(){c.UJ(a+1,b)},0);else if(5==a){this.dm=q;var d=this.sa.zoom;this.sa.Ca=this.Bx(); this.sa.dd=16*Math.pow(2,d-2);this.sa.Vt=Math.pow(2,d-1);this.sa.gn=Math.pow(2,d-2);this.sa.Np=Math.pow(2,7-d);this.P.Yy();this.refresh()}},p4:function(a,b){this.dm=o;var c=this.sa;this.eF={data:a,tV:b};this.eF.od=0;var d=Math.cos((a.dir+c.Pf)/180*Math.PI),c=-Math.sin((a.dir+c.Pf)/180*Math.PI),c=d=0;this.P.Hk();this.MR({index:1,p2:d,q2:c})},NW:function(a,b){if(!this.dm&&this.yt)if(1<this.sa.Tp)this.refresh();else{var c=this.sa,d=c.dd,e=512/d,f=c.Np,g=Math.cos(c.pitch),i=Math.cos(c.heading),k=Math.sin(c.heading), l=c.Ca*Math.sin(c.pitch),m=c.Ca*g*k;c.xq=-c.Ca*g*i;c.yq=l;c.zq=m;c.ss=i;c.mu=k;for(g=0;g<e;g++)for(i=0;i<e;i++){k={pb:{x:g*d,y:i*d-1},qb:{x:g*d-1,y:i*d+d+1},rb:{x:g*d+d+1,y:i*d+d}};l={pb:{x:g*d-1,y:i*d},qb:{x:g*d+d+1,y:i*d-1},rb:{x:g*d+d,y:i*d+d+1}};if(0==g)var n=-1;else g==f-1&&(n=1);if(0==i)var s=-1;else i==f-1&&(s=1);this.pD(k,a,b,c.zoom,n,s);this.qD(l,a,b,c.zoom,n,s)}}},MR:function(){var a=this.sa;this.rg.clearRect(0,0,a.a,a.bb);a.heading-=a.Pf/180*Math.PI;a.Pf=this.eF.tV.u4;a.heading+=a.Pf/180* Math.PI;this.Pk=this.eF.data.ye;this.dm=q;this.P.Yy();this.refresh()},Mn:function(a,b,c,d,e){var c=this.sa,b=2*(0.5*a.x/512+b/2)*Math.PI,f=(0.5-a.y/512)*Math.PI,g=c.Ca,a=Math.cos(f),i=Math.sin(Math.abs(f));0.4>i?i=0.4:0.98<i&&(i=c.Ut);var b=b+d*i,k=-a*Math.cos(b),i=Math.sin(f+e*i),l=a*Math.sin(b),e=c.ss,d=c.mu,b=c.xq,a=c.yq,f=c.zq,m=b*k+i*a+l*f;0>m&&(m=q);m=g*g/m;g=m*k-b;k=m*i-a;l=m*l-f;m=Math.pow(g,2)+Math.pow(k,2)+Math.pow(l,2);i=Math.sqrt(m);0==m?d=e=0:(m=(g*d+l*e)/i,1<m?m=1:-1>m&&(m=-1),m=Math.acos(m), 0>g*e*a+k*d*f-k*e*b-l*a*d&&(m=2*Math.PI-m),e=i*Math.cos(m),d=i*Math.sin(m));return{x:c.a/2+e,y:c.bb/2-d}},cL:function(a,b,c,d,e,f){var g=this.rg,i=0,k=0,l=0,m=0,n=this.sa.jq;d&&(1==d?k=n:-1==d&&(i=n));e&&(-1==e?l=n:1==e&&(m=n));d=this.sa.an;i=this.Mn(a.pb,b,c,-d-i,l,f);if(!i)return q;l=this.Mn(a.qb,b,c,d+k,d+l,f);if(!l)return q;c=this.Mn(a.rb,b,c,k,-d-m,f);if(!c)return q;c={pb:i,qb:l,rb:c};f=c.pb;k=c.qb;m=c.rb;g.save();g.beginPath();g.moveTo(f.x,f.y);g.lineTo(k.x,k.y);g.lineTo(m.x,m.y);g.closePath(); g.clip();a=this.Fk(a,c);g.transform(a[0],a[1],a[2],a[3],a[4],a[5]);g.drawImage(this.Pk[b],0,0);g.restore()},bL:function(a,b,c,d,e,f){var g=this.rg,i=0,k=0,l=0,m=0,n=this.sa.jq;d&&(1==d?k=n:-1==d&&(i=n));e&&(-1==e?l=n:1==e&&(m=n));d=this.sa.an;l=this.Mn(a.pb,b,c,-i,d+l,f);if(!l)return q;i=this.Mn(a.qb,b,c,-d-i,-d-m,f);if(!i)return q;c=this.Mn(a.rb,b,c,d+k,-m,f);if(!c)return q;c={pb:l,qb:i,rb:c};f=c.pb;k=c.qb;m=c.rb;g.save();g.beginPath();g.moveTo(f.x,f.y);g.lineTo(k.x,k.y);g.lineTo(m.x,m.y);g.closePath(); g.clip();a=this.Fk(a,c);g.transform(a[0],a[1],a[2],a[3],a[4],a[5]);g.drawImage(this.Pk[b],0,0);g.restore()},tW:function(){this.yt=q;this.P.Hk()},my:function(){this.yt=o;this.refresh();this.P.Yy()},ni:function(a){if(this.yt&&!this.dm){var b=this.sa;b.pitch=a.pitch/180*Math.PI-b.qs/180*Math.PI;b.heading=(a.heading+b.Pf)/180*Math.PI;b.heading>2*Math.PI?b.heading-=2*Math.PI:0>b.heading&&(b.heading+=2*Math.PI);a=b.dd;this.rg.clearRect(0,0,b.a,b.bb);var c=b.bound,d=c.Du,e=c.Ms,f=c.Ht,c=c.Yt,c=c>f?c-f:64+ c-f,g=b.Np,i=b.gq,k=Math.cos(b.pitch),l=Math.cos(b.heading),m=Math.sin(b.heading),n=b.Ca*Math.sin(b.pitch),s=b.Ca*k*m;b.xq=-b.Ca*k*l;b.yq=n;b.zq=s;b.ss=l;b.mu=m;for(k=0;k<c;k++)for(l=d;l<e;l++){s=k+f;63<s?s%=64:0>s&&(s+=64);var m=Math.floor(s/g),n=Math.floor(l/g),s=s%g,u=l%g,w={pb:{x:s*a,y:u*a-i},qb:{x:s*a-i,y:u*a+a+i},rb:{x:s*a+a+i,y:u*a+a}},y={pb:{x:s*a-i,y:u*a},qb:{x:s*a+a+i,y:u*a-i},rb:{x:s*a+a,y:u*a+a+i}};if(0==s)var D=-1;else s==g-1&&(D=1);if(0==u)var C=-1;else u==g-1&&(C=1);this.pD(w,m,n,b.zoom, D,C);this.qD(y,m,n,b.zoom,D,C)}}},refresh:function(){if(this.yt&&!this.dm){var a=this.sa,b=a.dd;this.rg.clearRect(0,0,a.a,a.bb);var c=this.UD(),d=c.Du,e=c.Ms,f=c.Ht,c=c.Yt,c=c>f?c-f:64+c-f,g=a.Np,i=Math.cos(a.pitch),k=Math.cos(a.heading),l=Math.sin(a.heading),m=a.Ca*Math.sin(a.pitch),n=a.Ca*i*l;a.xq=-a.Ca*i*k;a.yq=m;a.zq=n;a.ss=k;a.mu=l;i=a.gq;for(k=0;k<c;k++)for(l=d;l<e;l++){var s=k+f;63<s?s%=64:0>s&&(s+=64);var m=Math.floor(s/g),n=Math.floor(l/g),s=s%g,u=l%g,w={pb:{x:s*b,y:u*b-i},qb:{x:s*b-i,y:u* b+b+i},rb:{x:s*b+b+i,y:u*b+b}},y={pb:{x:s*b-i,y:u*b},qb:{x:s*b+b+i,y:u*b-i},rb:{x:s*b+b,y:u*b+b+i}};if(0==s)var D=-1;else s==g-1&&(D=1);if(0==u)var C=-1;else u==g-1&&(C=1);this.pD(w,m,n,a.zoom,D,C);this.qD(y,m,n,a.zoom,D,C)}}},RR:function(){var a=this.sa;this.rg.clearRect(0,0,a.a,a.bb);var b=a.gq,c=Math.cos(a.pitch),d=Math.cos(a.heading),e=Math.sin(a.heading),f=a.Ca*Math.sin(a.pitch),g=a.Ca*c*e;a.xq=-a.Ca*c*d;a.yq=f;a.zq=g;a.ss=d;a.mu=e;for(a=0;16>a;a++)for(c=0;16>c;c++){d={pb:{x:32*a,y:32*c-b},qb:{x:32* a-b,y:32*c+32+b},rb:{x:32*a+32+b,y:32*c+32}};e={pb:{x:32*a-b,y:32*c},qb:{x:32*a+32+b,y:32*c-b},rb:{x:32*a+32,y:32*c+32+b}};if(0==a)var i=-1;else 15==a&&(i=1);if(0==c)var k=-1;else 15==c&&(k=1);this.bL(d,0,2,i,k);this.cL(e,0,2,i,k);this.bL(d,1,2,i,k);this.cL(e,1,2,i,k)}},XD:function(a,b){var c=this.sa,d=a-c.a/2,e=c.bb/2-b,f=c.pitch+c.qs/180*Math.PI,g=c.heading-c.Pf/180*Math.PI,i=-c.Ca*Math.cos(f)*Math.cos(g),k=c.Ca*Math.sin(f),l=c.Ca*Math.cos(f)*Math.sin(g),m=d*Math.sin(g),d=d*Math.cos(g),n=e*Math.sin(f)* Math.cos(g),e=e*Math.cos(f),i=i+m+n,k=k+e,e=l+d+-e*Math.sin(f)*Math.sin(g),f=this.Fa(i,k,e);if(2<k)return q;g=2.08/(2.08-k);i*=g;e*=g;return{TG:i,UG:e,Ca:Math.sqrt(Math.pow(i,2)+Math.pow(e,2)),CF:c.Ca,heading:f.heading}},UD:function(a){var b=this.sa;a&&(b.heading=(a.heading+b.Pf)/180*Math.PI,b.heading>2*Math.PI?b.heading-=2*Math.PI:0>b.heading&&(b.heading+=2*Math.PI),b.pitch=a.pitch/180*Math.PI-b.qs/180*Math.PI);var c=Math.cos(b.pitch),d=Math.sin(b.pitch),e=Math.cos(b.heading),f=Math.sin(b.heading), a=-b.Ca*c*e,g=b.Ca*d,i=b.Ca*c*f,k=b.bb/2*d*e,l=b.bb/2*c,m=-b.bb/2*d*f,n=-b.bb/2*d*e,c=-b.bb/2*c,d=b.bb/2*d*f,s=-b.a/2*f,u=-b.a/2*e,f=b.a/2*f,e=b.a/2*e;if(0<b.pitch)var w=this.Fa(a+k+s,g+l+0,i+m+u),y=this.Fa(a+n,g+c,i+d),D=this.Fa(a+n+f,g+c+0,i+d+e);else var C=a+k,F=g+l,m=i+m,z=this.Fa(C,F,m),F=this.Fa(C+s,F+0,m+u),C=this.Fa(a+n+f,g+c+0,i+d+e);a=Math.atan(b.bb/2/b.Ca);b.pitch+a>Math.PI/2?(z=0,y=y.pitch<D.pitch?y.pitch:D.pitch,y=Math.ceil(32*(Math.PI/2-y)/Math.PI)):b.pitch-a<-Math.PI/2?(y=z.pitch>F.pitch? z.pitch:F.pitch,z=Math.floor(32*(Math.PI/2-y)/Math.PI),y=32):0<b.pitch?(z=Math.floor(32*(Math.PI/2-b.pitch-a)/Math.PI),y=y.pitch>D.pitch?D.pitch:y.pitch,y=Math.ceil(32*(Math.PI/2-y)/Math.PI)):(y=z.pitch>F.pitch?z.pitch:F.pitch,z=Math.floor(32*(Math.PI/2-y)/Math.PI),y=Math.ceil(32*(Math.PI/2-b.pitch+a)/Math.PI));Math.abs(b.pitch)>=Math.PI/2-a?(C=0,w=64):0<b.pitch?(C=Math.floor(32*w.heading/Math.PI),w=b.heading>w.heading?Math.ceil(32*(2*b.heading-w.heading)/Math.PI):Math.ceil(32*(2*b.heading+2*Math.PI- w.heading)/Math.PI)):(w=Math.ceil(32*C.heading/Math.PI),C=b.heading>C.heading?Math.floor(32*(2*b.heading-2*Math.PI-C.heading)/Math.PI):Math.floor(32*(2*b.heading-C.heading)/Math.PI));0>C&&(C+=64);64<w&&(w-=64);32<y&&(y=32);0>z&&(z=0);b.bound={Du:z,Ms:y,Ht:C,Yt:w};return{Du:z,Ms:y,Ht:C,Yt:w}},pD:function(a,b,c,d,e,f){if(2==this.Bi[b][c].um){var g=this.rg,i=0,k=0,l=0,m=0,n=this.sa.jq;e&&(1==e?k=n:-1==e&&(i=n));f&&(-1==f?l=n:1==f&&(m=n));e=this.sa.an;l=this.jg(a.pb,b,c,d,0,-i,e,l);if(!l)return q;i=this.jg(a.qb, b,c,d,-e,-i,-e,-m);if(!i)return q;d=this.jg(a.rb,b,c,d,e,k,0,-m);if(!d)return q;d={pb:l,qb:i,rb:d};k=d.pb;m=d.qb;i=d.rb;g.save();g.beginPath();g.moveTo(k.x,k.y);g.lineTo(m.x,m.y);g.lineTo(i.x,i.y);g.closePath();g.clip();a=this.Fk(a,d);g.transform(a[0],a[1],a[2],a[3],a[4],a[5]);g.drawImage(this.Bi[b][c].ye,0,0)}else{g=this.rg;m=l=k=i=0;n=0.0078125;e&&(1==e?k=n:-1==e&&(i=n));f&&(-1==f?l=n:1==f&&(m=n));e=0.0078125;l=this.jg(a.pb,b,c,d,0,-i,e,l);if(!l)return q;i=this.jg(a.qb,b,c,d,-e,-i,-e,-m);if(!i)return q; d=this.jg(a.rb,b,c,d,e,k,0,-m);if(!d)return q;d={pb:l,qb:i,rb:d};k=d.pb;m=d.qb;i=d.rb;g.save();g.beginPath();g.moveTo(k.x,k.y);g.lineTo(m.x,m.y);g.lineTo(i.x,i.y);g.closePath();g.clip();k=a.pb;m=a.qb;i=a.rb;l=this.sa.gn;e=512*b;c*=512;b>=l?(a.pb={x:(e+k.x)/l-512,y:(c+k.y)/l},a.qb={x:(e+m.x)/l-512,y:(c+m.y)/l},a.rb={x:(e+i.x)/l-512,y:(c+i.y)/l},a=this.Fk(a,d),g.transform(a[0],a[1],a[2],a[3],a[4],a[5]),g.drawImage(this.Pk[1],0,0)):(a.pb={x:(e+k.x)/l,y:(c+k.y)/l},a.qb={x:(e+m.x)/l,y:(c+m.y)/l},a.rb= {x:(e+i.x)/l,y:(c+i.y)/l},a=this.Fk(a,d),g.transform(a[0],a[1],a[2],a[3],a[4],a[5]),g.drawImage(this.Pk[0],0,0))}g.restore()},qD:function(a,b,c,d,e,f){if(2==this.Bi[b][c].um){var g=this.rg,i=0,k=0,l=0,m=0,n=this.sa.jq;e&&(1==e?k=n:-1==e&&(i=n));f&&(-1==f?l=n:1==f&&(m=n));e=this.sa.an;i=this.jg(a.pb,b,c,d,-e,-i,0,l);if(!i)return q;l=this.jg(a.qb,b,c,d,e,k,e,l);if(!l)return q;d=this.jg(a.rb,b,c,d,0,k,-e,-m);if(!d)return q;d={pb:i,qb:l,rb:d};k=d.pb;m=d.qb;l=d.rb;g.save();g.beginPath();g.moveTo(k.x,k.y); g.lineTo(m.x,m.y);g.lineTo(l.x,l.y);g.closePath();g.clip();a=this.Fk(a,d);g.transform(a[0],a[1],a[2],a[3],a[4],a[5]);g.drawImage(this.Bi[b][c].ye,0,0)}else{g=this.rg;m=l=k=i=0;n=0.0078125;e&&(1==e?k=n:-1==e&&(i=n));f&&(-1==f?l=n:1==f&&(m=n));e=0.0078125;i=this.jg(a.pb,b,c,d,-e,-i,0,l);if(!i)return q;l=this.jg(a.qb,b,c,d,e,k,e,l);if(!l)return q;d=this.jg(a.rb,b,c,d,0,k,-e,-m);if(!d)return q;d={pb:i,qb:l,rb:d};k=d.pb;m=d.qb;l=d.rb;g.save();g.beginPath();g.moveTo(k.x,k.y);g.lineTo(m.x,m.y);g.lineTo(l.x, l.y);g.closePath();g.clip();k=a.pb;m=a.qb;l=a.rb;i=this.sa.gn;e=512*b;c*=512;b>=i?(a.pb={x:(e+k.x)/i-512,y:(c+k.y)/i},a.qb={x:(e+m.x)/i-512,y:(c+m.y)/i},a.rb={x:(e+l.x)/i-512,y:(c+l.y)/i},a=this.Fk(a,d),g.transform(a[0],a[1],a[2],a[3],a[4],a[5]),g.drawImage(this.Pk[1],0,0)):(a.pb={x:(e+k.x)/i,y:(c+k.y)/i},a.qb={x:(e+m.x)/i,y:(c+m.y)/i},a.rb={x:(e+l.x)/i,y:(c+l.y)/i},a=this.Fk(a,d),g.transform(a[0],a[1],a[2],a[3],a[4],a[5]),g.drawImage(this.Pk[0],0,0))}g.restore()},jg:function(a,b,c,d,e,f,g,i){d=this.sa; b=2*(1/d.Vt*a.x/512+b/d.Vt)*Math.PI;c=(0.5-1/d.gn*a.y/512-c/d.gn)*Math.PI;a=Math.sin(Math.abs(c));0.4>a?a=0.4:0.98<a&&(a=d.Ut);var b=b+(e+f)*a,c=c+(g+i)*a,k=d.Ca,e=Math.cos(c),a=-e*Math.cos(b),c=Math.sin(c),l=e*Math.sin(b),b=d.ss,e=d.mu,f=d.xq,g=d.yq,i=d.zq,m=f*a+c*g+l*i;if(0>m)return q;k=k*k/m;a=k*a-f;c=k*c-g;l=k*l-i;m=Math.pow(a,2)+Math.pow(c,2)+Math.pow(l,2);k=Math.sqrt(m);0==m?e=b=0:(m=(a*e+l*b)/k,1<m?m=1:-1>m&&(m=-1),m=Math.acos(m),0>a*b*g+c*e*i-c*b*f-l*g*e&&(m=2*Math.PI-m),b=k*Math.cos(m),e= k*Math.sin(m));return{x:d.a/2+b,y:d.bb/2-e}},SX:function(a){var b=this.P.ia();if(b){var c=this.sa,d=c.heading,e=c.Ca,f=c.pitch+c.qs/180*Math.PI,d=d-c.Pf/180*Math.PI,g=6378137*-(a.lat-b.lat)/180*Math.PI,i=6378137*(a.lng-b.lng)/180*Math.PI,a=Math.sqrt(Math.pow(g,2)+Math.pow(i,2)),k=Math.cos(f),b=Math.cos(d),d=Math.sin(d),l=-e*k*b,f=e*Math.sin(f),k=e*k*d,m=l*g+-2.08*f+i*k;if(0>m)return q;var m=e*e/m,g=m*g-l,e=-2.08*m-f,m=m*i-k,n=Math.pow(g,2)+Math.pow(e,2)+Math.pow(m,2),i=Math.sqrt(n);0==n?d=b=0:(n= (g*d+m*b)/i,1<n?n=1:-1>n&&(n=-1),n=Math.acos(n),0>g*b*f+e*d*k-e*b*l-m*f*d&&(n=2*Math.PI-n),b=i*Math.cos(n),d=i*Math.sin(n));return{x:c.a/2+b,y:c.bb/2-d,Ca:a}}return q},Fa:function(a,b,c){var d=Math.pow(a,2),e=Math.pow(c,2);return{heading:0<c?Math.PI-Math.acos(a/Math.sqrt(d+e)):Math.PI+Math.acos(a/Math.sqrt(d+e)),pitch:Math.asin(b/Math.sqrt(d+Math.pow(b,2)+e))}},Fk:function(a,b){var c=a.pb.x,d=a.pb.y,e=a.qb.y,f=a.rb.y,g=b.pb.x,i=b.pb.y,k=b.qb.x,l=b.qb.y,m=b.rb.x,n=b.rb.y,s=e-d,u=f-d,w=a.qb.x-c,y=a.rb.x- c,s=e-d,u=f-d,e=m-g,l=l-i,k=k-g,n=n-i,f=y*s-w*u,s=[(e*s-k*u)/f,(n*s-l*u)/f,(e*w-k*y)/-f,(l*y-n*w)/f];s[4]=g-s[0]*c-s[2]*d;s[5]=i-s[3]*d-s[1]*c;return s}});function Wj(a){this.P=a;this.Ya=this.ea=p;this.Lv=0;this.ci=a.ci;this.LA=new Uj;this.Yg={};this.vo={};this.Ro={gi:0.0010,width:0,height:0,heading:0,pitch:0};this.P.sa=this;this.yH=0;this.Ud={};this.ca()} x.extend(Wj.prototype,{ca:function(){var a=this,b=a.P;b.addEventListener("size_changed",function(){a.Ud={}});b.addEventListener("zoom_changed_inner",function(){a.Ud={}})},setData:function(a){if(!this.ea||!(a&&a.id==this.ea.id))a?(this.Bp(),this.Ll=this.ea?this.ea.id:p,this.yB=this.ea?this.ea.tiles.dirNorth:p,this.XI=this.HA||p):this.yB=this.Ll=p,this.GJ=q,this.Ud={},this.ea=a,this.HA=this.P.Fa().heading},Bp:function(){if(We()){var a=this.P.jw.style,b=this.P.kw.style;a.hc=a.WebkitTransition="";b.hc= b.WebkitTransition="";a.visibility=b.visibility="hidden";a.opacity=b.opacity="0"}for(var c in this.Yg)this.vo[c]=this.Yg[c],this.vo[c].style.zIndex="0"},va:function(a,b,c){if(this.ea){var d=a.heading,e=a.pitch,f=this.P,g,i,k,l,m,n;this.Ud[this.ea.id]?(f=this.Ud[this.ea.id],i=f.Pf,k=f.UO,l=f.WO,m=f.UK,g=f.gi,n=f.HC,f=f.GC):(g=this.ea.tiles,i=g.dirNorth,n=f.Ka().clientWidth,f=f.Ka().clientHeight,k=g.op(b),l=g.Rx(b),m=360/k,g=360/(k*c),this.Ud[this.ea.id]={Pf:i,UO:k,WO:l,UK:m,gi:g,HC:n,GC:f},this.MQ()); this.XI=this.HA||p;this.HA=d;We()&&this.LU(d,e,b,c,g,n,f,i,k,l);this.Zg=c;i+=d;k=90-e;var e=Math.floor(i/m),d=Math.floor(k/m),s=n/2;i=Math.round(s-i%m/g);0>e&&(i-=c);k=Math.round(f/2-k%m/g);var u,w;this.yB&&(u=this.yB+this.XI,w=Math.round(s-u%m/g),u=Math.floor(u/m));u&&0>u&&(w-=c);m=d-Math.ceil(k/c);s=d+Math.ceil((f-k-c)/c);m=0>m?0:m;var s=s>l-1?l-1:s,y=e+Math.ceil((n-i-c)/c);l=[];for(var D={},c=e-Math.ceil(i/c);c<=y;c++)for(var C=m;C<=s;C++)l.push([c,C]),D[this.Mq(this.ea.id,c,C,b)]=o;for(F in this.Yg)if(!D[F]&& !this.vo[F]&&(c=this.Yg[F]))c.style.display="none";this.Lv+=l.length;l.sort(function(a){return function(b,c){return 0.4*Math.abs(b[0]-a[0])+0.6*Math.abs(b[1]-a[1])-(0.4*Math.abs(c[0]-a[0])+0.6*Math.abs(c[1]-a[1]))}}([e,d]));for(c=0;c<l.length;c++)this.MU(l[c][0],l[c][1],b,e,d,i,k,u,w);this.Ro.gi=g;this.Ro.width=n;this.Ro.height=f;this.Ro.heading=a.heading;this.Ro.pitch=a.pitch}else{for(var F in this.Yg)(c=this.Yg[F])&&c.parentNode&&c.parentNode.removeChild(c),delete this.Yg[F];We()&&(a=this.P.jw, b=this.P.kw,a&&(a.src=b.src="",a.style.visibility=b.style.visibility="hidden"))}},LU:function(a,b,c,d,e,f,g,i,k,l){var c=this.P.jw,m=this.P.kw,n=this,d=[k*d,l*d];if(!this.GJ||d!==this.yH)this.GJ=o,c.style.hc=c.style.WebkitTransition=m.style.hc=m.style.WebkitTransition="opacity 300ms ease-out",c.style.width=m.style.width=d[0]+"px",c.style.height=m.style.height=d[1]+"px",c.style.wV=m.style.wV=d[0]+"px, "+d[1]+"px",c.style.left=Math.round((0-i-a)/e+f/2)+"px",m.style.left=parseInt(c.style.left)+d[0]+ "px",c.onload=function(){-1!=this.src.indexOf("pos=0_0&z=1")&&n.P.dispatchEvent(new N("onthumbnail_complete"))},k="//mapsv0.bdimg.com/scape/?qt=pdata&sid="+this.ea.id+"&pos=0_0&z=1&from=JSAPI",c.src!=k&&(c.src=m.src=k);this.yH=d;a=Math.round((0-i-a)%360/e+f/2);c.style.top=m.style.top=Math.round(-(90-b)/e+g/2)+"px";0<a&&0>a-d[0]?(c.style.left=a+"px",m.style.left=parseInt(c.style.left)-d[0]+"px"):0<=a-d[0]?(m.style.left=a-d[0]+"px",c.style.left=parseInt(m.style.left)-d[0]+"px"):a+d[0]<f&&0<=a+d[0]? (c.style.left=a+"px",m.style.left=parseInt(c.style.left)+d[0]+"px"):0>a+d[0]?(m.style.left=a+d[0]+"px",c.style.left=parseInt(m.style.left)+d[0]+"px"):(c.style.left=a+"px",m.style.left=a+d[0]+"px")},MU:function(a,b,c,d,e,f,g,i,k){var l=this.ea.tiles,m=this.Zg,n=l.op(c),s=this.vo[this.Mq(this.Ll,a,b,c)];s&&(s=s.style,s.top=Math.round((b-e)*m+g)+"px",s.left=Math.round((a-(i||d))*m+(k||f))+"px",s.width=s.height=Math.ceil(m)+"px");var i=this.Mq(this.ea.id,a,b,c),u=this.Yg[i];if(u)l=u.style,l.top=Math.round((b- e)*m+g)+"px",l.left=Math.round((a-d)*m+f)+"px",l.width=l.height=Math.ceil(m)+"px",l.zIndex="2",l.display="",this.zf(),u.XB.x=a,u.XB.y=b;else{u=this.LA.Dx();u.setAttribute("errorCount",0);for(k=a;0>k;)k=n+k;var w=l.getTilesUrl(this.ea.id,new R((k+n)%n,b),c),y=this;u.onload=function(){y.zf();y.ci.appendChild(this);u.style.opacity="1"};u.onerror=function(){var a=this,b=a.getAttribute("errorCount");if(b<3){b++;setTimeout(function(){a.src=w},100);a.setAttribute("errorCount",b)}else y.zf()};l=u.style;l.position= "absolute";l.zIndex="2";l.border="none";l.display="";l.WebkitUserSelect="none";l.WebkitUserDrag="none";l.width=l.height=Math.ceil(m)+"px";l.top=Math.round((b-e)*m+g)+"px";l.left=Math.round((a-d)*m+f)+"px";l.opacity="0";l.hc=l.WebkitTransition="opacity 300ms ease-out";u.src=w;0<u.width&&(l.opacity="1");u.XB={id:this.ea.id,zoom:c,x:a,y:b};u.ontouchstart=function(a){a.preventDefault()};this.Yg[i]=u}},VS:function(a){var b=this.Yg[a];b&&(delete b.XB,b.onerror=b.onload=b.ontouchstart=p,b.style.display= "none");delete this.Yg[a];delete this.vo[a];b&&(b.sA=o,b.src="")},Oc:function(a,b){var c=this.cf;this.cf=b;c!=this.cf&&this.Bp()},Qk:function(){this.Ud={}},zf:function(){var a=this;this.Lv--;if(0==this.Lv){for(var b in this.vo)(function(){var c=b;setTimeout(function(){a.VS(c)},300)})();this.P.dispatchEvent(new N("ontilesloaded"))}},Mq:function(a,b,c,d){var e=this.ea.tiles.op(d),f=(b+e)%e;0==d&&(f=(b+2*e)%(2*e));return a+"_"+f+"_"+c+"_"+d},QX:function(a){var b=this.Ro,c=this.P.ia();if(c){var d=6378137* -(a.lat-c.lat)/180*Math.PI,e=6378137*(a.lng-c.lng)/180*Math.PI,a=Math.sqrt(Math.pow(d,2)+Math.pow(e,2)),c=b.heading%360-b.gi*b.width/2,f=b.pitch+b.gi*b.height/2,d=this.Fa(d,-2.08,e);return{x:(180*(d.heading%360/Math.PI)-c)/b.gi,y:(f-180*(d.pitch/Math.PI))/b.gi,Ca:a}}return q},Fa:function(a,b,c){var d=Math.pow(a,2),e=Math.pow(c,2);return{heading:0<c?Math.PI-Math.acos(a/Math.sqrt(d+e)):Math.PI+Math.acos(a/Math.sqrt(d+e)),pitch:Math.asin(b/Math.sqrt(d+Math.pow(b,2)+e))}},MQ:function(){var a=this.P,b= a.ih().height/2*this.Ud[this.ea.id].gi;a.A_(-90+b,90-b)}});function Nj(a){this.P=a;a.bB=this;this.ag=[];this.jH=[];this.Hq=[];this.iH=[];this.sl=[];this.kI=[];this.hw=[];this.dF=this.QI=this.OI=this.jv=this.iv=0;this.KK={};this.Lt=this.ly=q;Nb()?this.hf=this.hA():Ob()?(this.Xa=this.eA(),this.Mh=this.Xa.getContext("2d"),this.wQ(),this.ho=[]):Mb()&&(this.uw=this.sR());this.Ya=p;this.pz="#549eef";this.Ud={};this.ao=this.$j=o;this.ca()} var Zj=[[0,-11],[4,-6.5],[2,-6.5],[2,-3],[-2,-3],[-2,-6.5],[-4,-6.5]],$j=[[5,-2],[5,-12],[-5,-12],[-5,-2]],ak=[[0,-110],[40,-65],[20,-65],[20,-30],[-20,-30],[-20,-65],[-40,-65]],bk=[[45,-20],[45,-120],[-45,-120],[-45,-20]],ck="\\u5317 \\u4e1c\\u5317 \\u4e1c \\u4e1c\\u5357 \\u5357 \\u897f\\u5357 \\u897f \\u897f\\u5317 \\u5317".split(" "); x.extend(Nj.prototype,{hA:function(){var a=H("svg",{version:"1.1",overflow:"hidden"},"http://www.w3.org/2000/svg"),b=this.P,c=b.Ka().clientWidth,d=b.Ka().clientHeight;this.hf=a;this.iv=c;this.jv=d;this.OI=b.Ka().offsetLeft||0;this.QI=b.Ka().offsetTop||0;this.tJ(c,d);a.style.position="absolute";a.style.left="0";a.style.top="0";a.style.WebkitUserSelect=a.style.QP=a.style.MozUserSelect="none";b.bk.appendChild(a);Nb()&&"cvsRender"==this.P.jk&&this.u_(a);return a},u_:function(a){var b=this,c=H("ellipse", {fill:"white","fill-rule":"evenodd","fill-opacity":"0.4",cx:"100",cy:"100",rx:"20",ry:"20"},"http://www.w3.org/2000/svg");c.setAttribute("visibility","hidden");this.tD=c;a.appendChild(c);a=this.P.Ka();x.M(a,"mousedown",function(a){b.dF=(new Date).valueOf();b.$Z(a.offsetX||a.layerX||0,a.offsetY||a.layerY||0)});x.M(a,"mouseup",function(){200>(new Date).valueOf()-b.dF&&(b.ly&&b.P.k.visible)&&b.click();b.dF=0});x.M(a,"mousemove",function(a){b.a_(a.offsetX||a.layerX||0,a.offsetY||a.layerY||0);b.o_(a.offsetX|| a.layerX||0,a.offsetY||a.layerY||0)});x.da.Te?x.M(a,"mouseout",function(a){var c=a.clientX||a.pageX||0,a=a.clientY||a.pageY||0,c=c-b.OI,a=a-b.QI;(40>Math.abs(Math.abs(c-b.iv/2)-b.iv/2)||40>Math.abs(Math.abs(a-b.jv/2)-b.jv/2))&&b.tD.setAttribute("visibility","hidden")}):x.M(a,"mouseout",function(){b.tD.setAttribute("visibility","hidden")});b.P.addEventListener("hide_ellipse",function(){b.Lt=o});b.P.addEventListener("show_ellipse",function(){b.Lt=q})},eA:function(){var a=H("canvas"),b=this.P,c=b.Ka().clientWidth, d=b.Ka().clientHeight;this.Xa=a;a.width=c;a.height=d;var e=a.style;e.position="absolute";e.top=e.left="0";e.width=c+"px";e.height=d+"px";e.a1="rgba(0, 0, 0, 0)";b.bk.appendChild(a);return a},sR:function(){var a=this.P.Ka(),b=a.clientWidth,a=a.clientHeight;return Bb(this.P.bk,[\'<v:group style="behavior:url(#default#VML);z-index:1;width:\',b+"px;height:"+a+\'px;position:absolute;left:0;top:0;"\',\'coordsize="\'+b+","+a+\'" \',\'coordorigin="-\'+b/2+",-"+0.75*a+\'">\',"</v:group>"].join(""))},ca:function(){var a= this,b=a.P;b.addEventListener("size_changed",function(b){b=b.size;a.Ce(b.width,b.height);a.Ud={}});b.addEventListener("zoom_changed_inner",function(){a.Ud={}})},Ce:function(a,b){if(Nb())this.tJ(a,b);else if(Ob()){var c=this.Xa;c.width=a;c.height=b;c.style.width=a+"px";c.style.height=b+"px"}},tJ:function(a,b){this.hf&&(this.hf.setAttribute("width",a+"px"),this.hf.setAttribute("height",b+"px"),this.hf.setAttribute("viewBox","0 0 "+a+" "+b),this.iv=a,this.jv=b)},setData:da("ea"),va:function(a,b,c,d){if(this.ea){this.Ea= a;this.Kc=b;this.Zg=c;var e=(a.heading+360)%360,a=a.pitch,f=this.P,g=this.ea.tiles,i,k,l;this.Ud[this.ea.id]?(c=this.Ud[this.ea.id],i=c.HC,k=c.GC,c=c.gi):(i=f.Ka().clientWidth,k=f.Ka().clientHeight,l=g.op(b),b=g.Rx(b),c=360/(l*c),this.Ud[this.ea.id]={HC:i,GC:k,UO:l,WO:b,UK:360/l,gi:c});f=f.ga()+1;f=0.75*k+1*(a/c)/f;f<k/2&&(f=k/2);k=(90-a)/200;c=10;Nb()?this.ZI(this.ea.id,this.ea.links):Ob()?(this.Mh.clearRect(0,0,this.Xa.width,this.Xa.height),this.ea.id!=this.Ya&&(this.ho.length=0)):Mb()&&(c=36,this.YT(this.ea.id, this.ea.links));for(l=0;l<this.ea.links.length;l++){var b=this.ea.links[l].dir-e,b=(360+b)%360,g=i/2+50*Math.sin(Pb(b)),m=f-60*Math.cos(Pb(b))*k;if(Nb())this.DR(l,[i/2,f],[c,c*k],b),this.OR(l,[g,m]);else if(Ob()){var n="#444";d==l&&(n=this.pz);this.CH([i/2,f+3],[c,c*k],b,"#000",0.4);this.CH([i/2,f],[c,c*k],b,"#fff",0.95,n);this.PR(l,[g,m],n);b=[i/2+60*Math.sin(Pb(b)),f-50*Math.cos(Pb(b))*k];this.ho[l]=[Math.round(b[0]),Math.round(b[1])]}else Mb()&&(g=1,-30<a&&(g=80>a- -30?g+Math.tan(Pb(a- -30)):g+ 6),g=-Math.sin(Pb(Math.min(a,-30)))/g,this.uw.coordorigin=Math.round(-i/2)+","+Math.round(-f+40),this.ER(l,b,g))}}else Nb()?this.ZI(p,[]):(this.Mh.clearRect(0,0,this.Xa.width,this.Xa.height),this.ho.length=0)},ZI:function(a,b){if(a!=this.Ya){this.Ya=a;linksCount=b.length;if(linksCount>this.ag.length){for(var c=linksCount-this.ag.length,d=this.hf,e=0;e<c;e++){var f=H("path",{fill:"black","fill-rule":"evenodd","fill-opacity":"0.4",stroke:"none"},"http://www.w3.org/2000/svg"),g=H("path",{fill:"white", "fill-rule":"evenodd","fill-opacity":"0.9",stroke:"#444","stroke-width":"0.2","stroke-linecap":"round"},"http://www.w3.org/2000/svg"),i=["M"],k=Zj;i.push(k[0][0]);i.push(k[0][1]);for(var l=1;l<k.length;l++)i.push("L"),i.push(k[l][0]),i.push(k[l][1]);i.push(k[0][0]);i.push(k[0][1]);f.setAttribute("d",i.join(" "));this.Hq.push(f);d.appendChild(f);g.setAttribute("d",i.join(" "));this.ag.push(g);d.appendChild(g);l=H("text",{fill:"#444","fill-rule":"evenodd",stroke:"none","font-size":"16px","font-family":"arial", "text-anchor":"middle","alignment-baseline":"middle"},"http://www.w3.org/2000/svg");l.style.WebkitUserSelect=l.style.QP=l.style.MozUserSelect="none";this.hw.push(l);d.appendChild(l);var f=H("path",{fill:"white","fill-rule":"evenodd","fill-opacity":"0",stroke:"none",cursor:"pointer"},"http://www.w3.org/2000/svg"),m=this;f.gH=g;f.FJ=l;f.style.MozUserSelect="none";g=["M"];i=$j;g.push(i[0][0]);g.push(i[0][1]);for(l=1;l<i.length;l++)g.push("L"),g.push(i[l][0]),g.push(i[l][1]);f.setAttribute("d",g.join(" ")); x.M(f,J()?"touchstart":"mousedown",function(a){m.yo={heading:m.Ea.heading,pitch:m.Ea.pitch};m.Sq=this;this.gH.setAttribute("stroke",m.pz);this.FJ.setAttribute("fill",m.pz);Db(a)});this.sl.push(f);d.appendChild(f);x.M(f,"mousemove",function(){m.Lt=o});x.M(f,"mouseout",function(){m.Lt=q})}x.M(this.P.C,J()?"touchend":"mouseup",function(a){if(m.Sq){if(m.Ea.heading==m.yo.heading&&m.Ea.pitch==m.yo.pitch){var b=m.Sq.getAttribute("sid");b&&(m.P.dispatchEvent(new N("onlinkclick")),m.P.rc(b));m.L1=m.M1=p}m.Sq.gH.setAttribute("stroke", "#444");m.Sq.FJ.setAttribute("fill","#444");m.yo=p;m.Sq=p;a.stopPropagation()}})}for(e=0;e<this.ag.length;e++)c="",e<linksCount?(d=this.hw[e],0<d.childNodes.length&&d.removeChild(d.childNodes[0]),l=this.UH(b[e].dir),d.appendChild(document.createTextNode(l)),this.sl[e].setAttribute("sid",b[e].id)):c="none",this.ag[e].style.display=c,this.Hq[e].style.display=c,this.hw[e].style.display=c,this.sl[e].style.display=c}},wQ:function(){var a=this,b=a.P;x.M(this.Xa,"touchstart",function(b){a.yo={heading:a.Ea.heading, pitch:a.Ea.pitch};var d=Cb(a.Xa);a.zv=a.OL(b.touches[0].clientX-d.left,b.touches[0].clientY-d.top);a.va(a.Ea,a.Kc,a.Zg,a.zv)});x.M(this.Xa,"touchend",function(){a.Ea.heading==a.yo.heading&&a.Ea.pitch==a.yo.pitch&&a.ea.links[a.zv]&&(b.dispatchEvent(new N("onlinkclick")),b.rc(a.ea.links[a.zv].id));a.zv=p})},OL:function(a,b){for(var c=0;c<this.ho.length;c++)if(30>Math.abs(a-this.ho[c][0])&&30>Math.abs(b-this.ho[c][1]))return c;return-1},YT:function(a,b){if(a!=this.Ya){this.Ya=a;linksCount=b.length;if(linksCount> this.ag.length)for(var c=linksCount-this.ag.length,d=0;d<c;d++){for(var e=[],f=ak,g=0;g<f.length;g++)e.push(f[g][0]),e.push(f[g][1]);e.push(f[0][0]);e.push(f[0][1]);g=Bb(this.uw,["<v:polyline ",\'points="\'+e.join(" ")+\'"\',\' style="behavior:url(#default#VML);z-index:1;left:0;top:0;" stroked="false"><v:fill style="behavior:url(#default#VML)" color="black" opacity="0.5"></v:fill><v:skew style="behavior:url(#default#VML)" on="true" origin="0,1.5" matrix="1,0,0,1,0,0" offset="0,0.05"></v:skew></v:polyline>\'].join("")); this.Hq.push(g);this.iH.push(g.getElementsByTagName("skew")[0]);g=Bb(this.uw,["<v:polyline ",\'points="\'+e.join(" ")+\'"\',\'fillcolor="white" stroked="true" strokecolor="#444" strokeweight="1"  style="behavior:url(#default#VML);z-index:2;left:0;top:0;"><v:fill style="behavior:url(#default#VML)" color="white" opacity="1"></v:fill><v:skew style="behavior:url(#default#VML)" on="true" origin="0,1.5" matrix="1,0,0,1,0,0" offset="0,0"></v:skew></v:polyline>\'].join(""));this.ag.push(g);this.jH.push(g.getElementsByTagName("skew")[0]); e=[];f=bk;for(g=0;g<f.length;g++)e.push(f[g][0]),e.push(f[g][1]);var g=Bb(this.uw,[\'<v:polyline style="cursor:pointer;z-index:3;behavior:url(#default#VML);"\',\' points="\'+e.join(" ")+\'" stroked="false">\',\'<v:fill style="behavior:url(#default#VML);" color="white" opacity="0"></v:fill><v:skew style="behavior:url(#default#VML);" on="true" origin="0,1.2" matrix="1,0,0,1,0,0"></v:skew></v:polyline>\'].join("")),i=this;x.M(g,"click",function(a){(a=a.srcElement.sid)&&i.P.rc(a)});this.sl.push(g);this.kI.push(g.getElementsByTagName("skew")[0])}for(d= 0;d<this.ag.length;d++)c="",d<linksCount?this.sl[d].sid=b[d].id:c="none",this.ag[d].style.display=c,this.Hq[d].style.display=c,this.sl[d].style.display=c}},DR:function(a,b,c,d){this.ag[a]&&(this.ag[a].setAttribute("transform","translate("+b[0]+" "+b[1]+")scale("+c[0]+" "+c[1]+")rotate("+d+")"),this.Hq[a].setAttribute("transform","translate("+b[0]+" "+(b[1]+4)+")scale("+c[0]+" "+c[1]+")rotate("+d+")"),this.sl[a].setAttribute("transform","translate("+b[0]+" "+b[1]+")scale("+c[0]+" "+c[1]+")rotate("+ d+")"))},OR:function(a,b){this.hw[a].setAttribute("transform","translate("+b[0]+" "+b[1]+")")},ER:function(a,b,c){this.Kz(this.jH[a],b,0,c);this.Kz(this.iH[a],b,0.6,c);this.Kz(this.kI[a],b,0,c)},Kz:function(a,b,c,d){var e=Pb(b),b=Math.cos(e),e=Math.sin(e);a.matrix=[Number(b).toFixed(4),Number(-e).toFixed(4),Number(e*d).toFixed(4),Number(b*d).toFixed(4),0,0].join();a.offset="0,"+Math.round(50*c)/1E3},CH:function(a,b,c,d,e,f){var g=this.Mh;g.save();g.fillStyle=d;g.globalAlpha=e;g.translate(a[0],a[1]); g.scale(b[0],b[1]);g.rotate(Pb(c));g.beginPath();g.moveTo(Zj[0][0],Zj[0][1]);for(a=1;a<Zj.length;a++)g.lineTo(Zj[a][0],Zj[a][1]);g.closePath();g.fill();f&&(g.lineWidth="0.2",g.lineCap="round",g.lineJoin="round",g.strokeStyle=f,g.stroke());g.restore()},PR:function(a,b,c){var d=this.Mh;d.save();a=this.UH(this.ea.links[a].dir);d.font="16px sans-serif";d.textAlign="center";d.textBaseline="middle";d.fillStyle=c;d.fillText(a,b[0],b[1]);d.restore()},UH:function(a){return ck[Math.ceil(Math.floor((a+360)% 360/22.5)/2)]},eM:ea(0),click:function(){if(!(2<Math.abs(this.LW-this.hZ)||2<Math.abs(this.$K-this.$K))){var a=this.KK;if(a){for(var b=this.ea.links,c=this.CX(a.TG,a.UG),d=30,e=0,f=0;f<b.length;f++)e=b[f].dir-c,e=180<Math.abs(e)?b[f].dir>c?360+c-b[f].dir:360-c+b[f].dir:Math.abs(e),e<d&&(d=e);29>d&&(b=this.P.ia(),this.P.ta(new O(b.lng+180*a.UG/Math.PI/6378137,b.lat-180*a.TG/Math.PI/6378137)))}}},$Z:function(a,b){this.LW=a;this.$K=b},a_:da("hZ"),o_:function(a,b){this.KK=coord=this.P.sa.XD(a,b);var c= this.tD;if(coord&&!this.Lt&&this.P.k.visible){c.setAttribute("cx",a);c.setAttribute("cy",b);var d=Math.abs(2*coord.CF/(coord.Ca-2)-2*coord.CF/(coord.Ca+2))/2,e=2*coord.CF/coord.Ca;if(4<coord.Ca){if(100<e){var f=e/100,e=100,d=d/f;d>e&&(d=e)}c.setAttribute("rx",e);c.setAttribute("ry",d);c.setAttribute("visibility","visible");this.ly=o}else this.ly=q,c.setAttribute("visibility","hidden")}else this.ly=q,c.setAttribute("visibility","hidden")},CX:function(a,b){var c=0;0<a?c=180*(Math.atan(b/a)/Math.PI): 0>a?c=180*(Math.atan(b/a)/Math.PI)+180:0==a&&(c=0<b?90:-90);heading=180-c;360<heading?heading-=360:0>heading&&(heading+=360);return heading},U:function(){this.$j=q;this.P.bk&&(this.P.bk.style.visibility="hidden")},show:function(){this.$j=o;this.P.bk&&(this.P.bk.style.visibility="visible")},vD:function(){this.ao=o},$C:function(){this.ao=q}});var dk={get:function(a,b){var c="inst_"+b;dk[c]||(dk[c]=new ek(a));return dk[c]}};function ek(a){this.jb=a;this.Wu=new Uint8Array(16);this.br=new Uint8Array(16)}x.extend(ek.prototype,{zE:function(){for(var a=0,b=this.Wu.length;a<b;a++)this.Wu[a]=0},Yo:function(a){this.Wu[a]=1;0===this.br[a]&&(this.jb.enableVertexAttribArray(a),this.br[a]=1)},cD:function(){for(var a=0,b=this.br.length;a<b;a++)this.br[a]!==this.Wu[a]&&(this.jb.disableVertexAttribArray(a),this.br[a]=0)}});if(!fk)var fk=1.0E-6;if(!gk)var gk="undefined"!==typeof Float32Array?Float32Array:Array;if(!hk)var hk=Math.random;var ik={N4:function(a){gk=a}};"undefined"!==typeof exports&&(exports.x3=ik);var jk=Math.PI/180;ik.X4=function(a){return a*jk}; var kk={create:function(){var a=new gk(2);a[0]=0;a[1]=0;return a},ji:function(a){var b=new gk(2);b[0]=a[0];b[1]=a[1];return b},tg:function(a,b){var c=new gk(2);c[0]=a;c[1]=b;return c},copy:function(a,b){a[0]=b[0];a[1]=b[1];return a},set:function(a,b,c){a[0]=b;a[1]=c;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return a},uu:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];return a}};kk.sub=kk.uu;kk.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];return a};kk.Zm=kk.multiply; kk.Is=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];return a};kk.YK=kk.Is;kk.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);return a};kk.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);return a};kk.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;return a};kk.hO=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;return a};kk.od=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)};kk.Ca=kk.od; kk.ru=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d};kk.CO=kk.ru;kk.length=function(a){var b=a[0],a=a[1];return Math.sqrt(b*b+a*a)};kk.UE=kk.length;kk.Xk=function(a){var b=a[0],a=a[1];return b*b+a*a};kk.XF=kk.Xk;kk.qN=function(a,b){a[0]=-b[0];a[1]=-b[1];return a};kk.normalize=function(a,b){var c=b[0],d=b[1],c=c*c+d*d;if(c>0){c=1/Math.sqrt(c);a[0]=b[0]*c;a[1]=b[1]*c}return a};kk.Ls=function(a,b){return a[0]*b[0]+a[1]*b[1]};kk.fx=function(a,b,c){b=b[0]*c[1]-b[1]*c[0];a[0]=a[1]=0;a[2]=b;return a}; kk.hy=function(a,b,c,d){var e=b[0],b=b[1];a[0]=e+d*(c[0]-e);a[1]=b+d*(c[1]-b);return a};kk.random=function(a,b){var b=b||1,c=hk()*2*Math.PI;a[0]=Math.cos(c)*b;a[1]=Math.sin(c)*b;return a};kk.d5=function(a,b,c){var d=b[0],b=b[1];a[0]=c[0]*d+c[2]*b;a[1]=c[1]*d+c[3]*b;return a};kk.e5=function(a,b,c){var d=b[0],b=b[1];a[0]=c[0]*d+c[2]*b+c[4];a[1]=c[1]*d+c[3]*b+c[5];return a};kk.m0=function(a,b,c){var d=b[0],b=b[1];a[0]=c[0]*d+c[3]*b+c[6];a[1]=c[1]*d+c[4]*b+c[7];return a}; kk.YO=function(a,b,c){var d=b[0],b=b[1];a[0]=c[0]*d+c[4]*b+c[12];a[1]=c[1]*d+c[5]*b+c[13];return a};kk.forEach=function(){var a=kk.create();return function(b,c,d,e,f,g){c||(c=2);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;d<e;d=d+c){a[0]=b[d];a[1]=b[d+1];f(a,a,g);b[d]=a[0];b[d+1]=a[1]}return b}}();kk.xn=function(a){return"vec2("+a[0]+", "+a[1]+")"};"undefined"!==typeof exports&&(exports.i5=kk); var lk={create:function(){var a=new gk(3);a[0]=0;a[1]=0;a[2]=0;return a},ji:function(a){var b=new gk(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},tg:function(a,b,c){var d=new gk(3);d[0]=a;d[1]=b;d[2]=c;return d},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,c,d){a[0]=b;a[1]=c;a[2]=d;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a},uu:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}};lk.sub=lk.uu; lk.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a};lk.Zm=lk.multiply;lk.Is=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a};lk.YK=lk.Is;lk.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);return a};lk.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};lk.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a}; lk.hO=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;return a};lk.od=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)};lk.Ca=lk.od;lk.ru=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e};lk.CO=lk.ru;lk.length=function(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)};lk.UE=lk.length;lk.Xk=function(a){var b=a[0],c=a[1],a=a[2];return b*b+c*c+a*a};lk.XF=lk.Xk; lk.qN=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};lk.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],c=c*c+d*d+e*e;if(c>0){c=1/Math.sqrt(c);a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c}return a};lk.Ls=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};lk.fx=function(a,b,c){var d=b[0],e=b[1],b=b[2],f=c[0],g=c[1],c=c[2];a[0]=e*c-b*g;a[1]=b*f-d*c;a[2]=d*g-e*f;return a};lk.hy=function(a,b,c,d){var e=b[0],f=b[1],b=b[2];a[0]=e+d*(c[0]-e);a[1]=f+d*(c[1]-f);a[2]=b+d*(c[2]-b);return a}; lk.random=function(a,b){var b=b||1,c=hk()*2*Math.PI,d=hk()*2-1,e=Math.sqrt(1-d*d)*b;a[0]=Math.cos(c)*e;a[1]=Math.sin(c)*e;a[2]=d*b;return a};lk.YO=function(a,b,c){var d=b[0],e=b[1],b=b[2];a[0]=c[0]*d+c[4]*e+c[8]*b+c[12];a[1]=c[1]*d+c[5]*e+c[9]*b+c[13];a[2]=c[2]*d+c[6]*e+c[10]*b+c[14];return a};lk.m0=function(a,b,c){var d=b[0],e=b[1],b=b[2];a[0]=d*c[0]+e*c[3]+b*c[6];a[1]=d*c[1]+e*c[4]+b*c[7];a[2]=d*c[2]+e*c[5]+b*c[8];return a}; lk.o0=function(a,b,c){var d=b[0],e=b[1],f=b[2],b=c[0],g=c[1],i=c[2],c=c[3],k=c*d+g*f-i*e,l=c*e+i*d-b*f,m=c*f+b*e-g*d,d=-b*d-g*e-i*f;a[0]=k*c+d*-b+l*-i-m*-g;a[1]=l*c+d*-g+m*-b-k*-i;a[2]=m*c+d*-i+k*-g-l*-b;return a};lk.cO=function(a,b,c,d){var e=[],f=[];e[0]=b[0]-c[0];e[1]=b[1]-c[1];e[2]=b[2]-c[2];f[0]=e[0];f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d);f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d);a[0]=f[0]+c[0];a[1]=f[1]+c[1];a[2]=f[2]+c[2];return a}; lk.dO=function(a,b,c,d){var e=[],f=[];e[0]=b[0]-c[0];e[1]=b[1]-c[1];e[2]=b[2]-c[2];f[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d);f[1]=e[1];f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d);a[0]=f[0]+c[0];a[1]=f[1]+c[1];a[2]=f[2]+c[2];return a};lk.eO=function(a,b,c,d){var e=[],f=[];e[0]=b[0]-c[0];e[1]=b[1]-c[1];e[2]=b[2]-c[2];f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d);f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d);f[2]=e[2];a[0]=f[0]+c[0];a[1]=f[1]+c[1];a[2]=f[2]+c[2];return a}; lk.forEach=function(){var a=lk.create();return function(b,c,d,e,f,g){c||(c=3);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;d<e;d=d+c){a[0]=b[d];a[1]=b[d+1];a[2]=b[d+2];f(a,a,g);b[d]=a[0];b[d+1]=a[1];b[d+2]=a[2]}return b}}();lk.xn=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof exports&&(exports.j5=lk); var Rj={create:function(){var a=new gk(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a},ji:function(a){var b=new gk(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},tg:function(a,b,c,d){var e=new gk(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,c,d,e){a[0]=b;a[1]=c;a[2]=d;a[3]=e;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a},uu:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]- c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}};Rj.sub=Rj.uu;Rj.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return a};Rj.Zm=Rj.multiply;Rj.Is=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];a[3]=b[3]/c[3];return a};Rj.YK=Rj.Is;Rj.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);a[3]=Math.min(b[3],c[3]);return a}; Rj.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);a[3]=Math.max(b[3],c[3]);return a};Rj.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a};Rj.hO=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;return a};Rj.od=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)};Rj.Ca=Rj.od; Rj.ru=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f};Rj.CO=Rj.ru;Rj.length=function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};Rj.UE=Rj.length;Rj.Xk=function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return b*b+c*c+d*d+a*a};Rj.XF=Rj.Xk;Rj.qN=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a}; Rj.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],c=c*c+d*d+e*e+f*f;if(c>0){c=1/Math.sqrt(c);a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c}return a};Rj.Ls=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};Rj.hy=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],b=b[3];a[0]=e+d*(c[0]-e);a[1]=f+d*(c[1]-f);a[2]=g+d*(c[2]-g);a[3]=b+d*(c[3]-b);return a};Rj.random=function(a,b){b=b||1;a[0]=hk();a[1]=hk();a[2]=hk();a[3]=hk();Rj.normalize(a,a);Rj.scale(a,a,b);return a}; Rj.YO=function(a,b,c){var d=b[0],e=b[1],f=b[2],b=b[3];a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*b;a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*b;a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*b;a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*b;return a};Rj.o0=function(a,b,c){var d=b[0],e=b[1],f=b[2],b=c[0],g=c[1],i=c[2],c=c[3],k=c*d+g*f-i*e,l=c*e+i*d-b*f,m=c*f+b*e-g*d,d=-b*d-g*e-i*f;a[0]=k*c+d*-b+l*-i-m*-g;a[1]=l*c+d*-g+m*-b-k*-i;a[2]=m*c+d*-i+k*-g-l*-b;return a}; Rj.forEach=function(){var a=Rj.create();return function(b,c,d,e,f,g){c||(c=4);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;d<e;d=d+c){a[0]=b[d];a[1]=b[d+1];a[2]=b[d+2];a[3]=b[d+3];f(a,a,g);b[d]=a[0];b[d+1]=a[1];b[d+2]=a[2];b[d+3]=a[3]}return b}}();Rj.xn=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof exports&&(exports.k5=Rj); var mk={create:function(){var a=new gk(4);a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},ji:function(a){var b=new gk(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},Qm:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},$O:function(a,b){if(a===b){var c=b[1];a[1]=b[2];a[2]=c}else{a[0]=b[0];a[1]=b[2];a[2]=b[1];a[3]=b[3]}return a},xp:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;if(!g)return p;g=1/g;a[0]=f*g;a[1]=-d*g;a[2]=-e*g; a[3]=c*g;return a},gK:function(a,b){var c=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=c;return a},XC:function(a){return a[0]*a[3]-a[2]*a[1]},multiply:function(a,b,c){var d=b[0],e=b[1],f=b[2],b=b[3],g=c[0],i=c[1],k=c[2],c=c[3];a[0]=d*g+f*i;a[1]=e*g+b*i;a[2]=d*k+f*c;a[3]=e*k+b*c;return a}};mk.Zm=mk.multiply;mk.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],b=b[3],g=Math.sin(c),c=Math.cos(c);a[0]=d*c+f*g;a[1]=e*c+b*g;a[2]=d*-g+f*c;a[3]=e*-g+b*c;return a}; mk.scale=function(a,b,c){var d=b[1],e=b[2],f=b[3],g=c[0],c=c[1];a[0]=b[0]*g;a[1]=d*g;a[2]=e*c;a[3]=f*c;return a};mk.xn=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};mk.MD=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};mk.U0=function(a,b,c,d){a[2]=d[2]/d[0];c[0]=d[0];c[1]=d[1];c[3]=d[3]-a[2]*c[1];return[a,b,c]};"undefined"!==typeof exports&&(exports.W3=mk); var nk={create:function(){var a=new gk(6);a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},ji:function(a){var b=new gk(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},Qm:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},xp:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=c*f-d*e;if(!k)return p;k=1/k;a[0]=f*k;a[1]=-d*k;a[2]=-e*k;a[3]=c*k;a[4]=(e*i-f*g)*k;a[5]= (d*g-c*i)*k;return a},XC:function(a){return a[0]*a[3]-a[1]*a[2]},multiply:function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],b=b[5],k=c[0],l=c[1],m=c[2],n=c[3],s=c[4],c=c[5];a[0]=d*k+f*l;a[1]=e*k+g*l;a[2]=d*m+f*n;a[3]=e*m+g*n;a[4]=d*s+f*c+i;a[5]=e*s+g*c+b;return a}};nk.Zm=nk.multiply;nk.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],b=b[5],k=Math.sin(c),c=Math.cos(c);a[0]=d*c+f*k;a[1]=e*c+g*k;a[2]=d*-k+f*c;a[3]=e*-k+g*c;a[4]=i;a[5]=b;return a}; nk.scale=function(a,b,c){var d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=c[0],c=c[1];a[0]=b[0]*k;a[1]=d*k;a[2]=e*c;a[3]=f*c;a[4]=g;a[5]=i;return a};nk.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],b=b[5],k=c[0],c=c[1];a[0]=d;a[1]=e;a[2]=f;a[3]=g;a[4]=d*k+f*c+i;a[5]=e*k+g*c+b;return a};nk.xn=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"}; nk.MD=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};"undefined"!==typeof exports&&(exports.X3=nk); var ok={create:function(){var a=new gk(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},H2:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a},ji:function(a){var b=new gk(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},Qm:function(a){a[0]= 1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},$O:function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=d;a[7]=e}else{a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8]}return a},xp:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=b[6],l=b[7],m=b[8],n=m*g-i*l,s=-m*f+i*k,u=l*f-g*k,w=c*n+d*s+e*u;if(!w)return p;w=1/w;a[0]=n*w;a[1]=(-m*d+e*l)*w;a[2]=(i*d-e*g)*w;a[3]=s*w;a[4]=(m*c-e*k)*w;a[5]= (-i*c+e*f)*w;a[6]=u*w;a[7]=(-l*c+d*k)*w;a[8]=(g*c-d*f)*w;return a},gK:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=b[6],l=b[7],m=b[8];a[0]=g*m-i*l;a[1]=e*l-d*m;a[2]=d*i-e*g;a[3]=i*k-f*m;a[4]=c*m-e*k;a[5]=e*f-c*i;a[6]=f*l-g*k;a[7]=d*k-c*l;a[8]=c*g-d*f;return a},XC:function(a){var b=a[3],c=a[4],d=a[5],e=a[6],f=a[7],g=a[8];return a[0]*(g*c-d*f)+a[1]*(-g*b+d*e)+a[2]*(f*b-c*e)},multiply:function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],l=b[6],m=b[7],b=b[8],n=c[0],s=c[1],u= c[2],w=c[3],y=c[4],D=c[5],C=c[6],F=c[7],c=c[8];a[0]=n*d+s*g+u*l;a[1]=n*e+s*i+u*m;a[2]=n*f+s*k+u*b;a[3]=w*d+y*g+D*l;a[4]=w*e+y*i+D*m;a[5]=w*f+y*k+D*b;a[6]=C*d+F*g+c*l;a[7]=C*e+F*i+c*m;a[8]=C*f+F*k+c*b;return a}};ok.Zm=ok.multiply;ok.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],l=b[6],m=b[7],b=b[8],n=c[0],c=c[1];a[0]=d;a[1]=e;a[2]=f;a[3]=g;a[4]=i;a[5]=k;a[6]=n*d+c*g+l;a[7]=n*e+c*i+m;a[8]=n*f+c*k+b;return a}; ok.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],l=b[6],m=b[7],b=b[8],n=Math.sin(c),c=Math.cos(c);a[0]=c*d+n*g;a[1]=c*e+n*i;a[2]=c*f+n*k;a[3]=c*g-n*d;a[4]=c*i-n*e;a[5]=c*k-n*f;a[6]=l;a[7]=m;a[8]=b;return a};ok.scale=function(a,b,c){var d=c[0],c=c[1];a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};ok.G2=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a}; ok.gX=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,i=d+d,k=e+e,c=c*g,l=d*g,d=d*i,m=e*g,n=e*i,e=e*k,g=f*g,i=f*i,f=f*k;a[0]=1-d-e;a[3]=l-f;a[6]=m+i;a[1]=l+f;a[4]=1-c-e;a[7]=n-g;a[2]=m-i;a[5]=n+g;a[8]=1-c-d;return a}; ok.a4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=b[6],l=b[7],m=b[8],n=b[9],s=b[10],u=b[11],w=b[12],y=b[13],D=b[14],C=b[15],F=c*i-d*g,z=c*k-e*g,A=c*l-f*g,E=d*k-e*i,G=d*l-f*i,P=e*l-f*k,S=m*y-n*w,ba=m*D-s*w,m=m*C-u*w,ca=n*D-s*y,n=n*C-u*y,s=s*C-u*D,u=F*s-z*n+A*ca+E*m-G*ba+P*S;if(!u)return p;u=1/u;a[0]=(i*s-k*n+l*ca)*u;a[1]=(k*m-g*s-l*ba)*u;a[2]=(g*n-i*m+l*S)*u;a[3]=(e*n-d*s-f*ca)*u;a[4]=(c*s-e*m+f*ba)*u;a[5]=(d*m-c*n-f*S)*u;a[6]=(y*P-D*G+C*E)*u;a[7]=(D*A-w*P-C*z)*u;a[8]=(w*G-y*A+C* F)*u;return a};ok.xn=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};ok.MD=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof exports&&(exports.Y3=ok); var Sj={create:function(){var a=new gk(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},ji:function(a){var b=new gk(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9]; a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},Qm:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},$O:function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],i=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=d;a[9]=f;a[11]=b[14];a[12]=e;a[13]=g;a[14]=i}else{a[0]=b[0];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=b[1];a[5]=b[5];a[6]=b[9];a[7]=b[13];a[8]=b[2]; a[9]=b[6];a[10]=b[10];a[11]=b[14];a[12]=b[3];a[13]=b[7];a[14]=b[11];a[15]=b[15]}return a},xp:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=b[6],l=b[7],m=b[8],n=b[9],s=b[10],u=b[11],w=b[12],y=b[13],D=b[14],C=b[15],F=c*i-d*g,z=c*k-e*g,A=c*l-f*g,E=d*k-e*i,G=d*l-f*i,P=e*l-f*k,S=m*y-n*w,ba=m*D-s*w,ca=m*C-u*w,Ma=n*D-s*y,Sa=n*C-u*y,Wa=s*C-u*D,Da=F*Wa-z*Sa+A*Ma+E*ca-G*ba+P*S;if(!Da)return p;Da=1/Da;a[0]=(i*Wa-k*Sa+l*Ma)*Da;a[1]=(e*Sa-d*Wa-f*Ma)*Da;a[2]=(y*P-D*G+C*E)*Da;a[3]=(s*G-n*P-u*E)* Da;a[4]=(k*ca-g*Wa-l*ba)*Da;a[5]=(c*Wa-e*ca+f*ba)*Da;a[6]=(D*A-w*P-C*z)*Da;a[7]=(m*P-s*A+u*z)*Da;a[8]=(g*Sa-i*ca+l*S)*Da;a[9]=(d*ca-c*Sa-f*S)*Da;a[10]=(w*G-y*A+C*F)*Da;a[11]=(n*A-m*G-u*F)*Da;a[12]=(i*ba-g*Ma-k*S)*Da;a[13]=(c*Ma-d*ba+e*S)*Da;a[14]=(y*z-w*E-D*F)*Da;a[15]=(m*E-n*z+s*F)*Da;return a},gK:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=b[6],l=b[7],m=b[8],n=b[9],s=b[10],u=b[11],w=b[12],y=b[13],D=b[14],C=b[15];a[0]=i*(s*C-u*D)-n*(k*C-l*D)+y*(k*u-l*s);a[1]=-(d*(s*C-u*D)-n*(e* C-f*D)+y*(e*u-f*s));a[2]=d*(k*C-l*D)-i*(e*C-f*D)+y*(e*l-f*k);a[3]=-(d*(k*u-l*s)-i*(e*u-f*s)+n*(e*l-f*k));a[4]=-(g*(s*C-u*D)-m*(k*C-l*D)+w*(k*u-l*s));a[5]=c*(s*C-u*D)-m*(e*C-f*D)+w*(e*u-f*s);a[6]=-(c*(k*C-l*D)-g*(e*C-f*D)+w*(e*l-f*k));a[7]=c*(k*u-l*s)-g*(e*u-f*s)+m*(e*l-f*k);a[8]=g*(n*C-u*y)-m*(i*C-l*y)+w*(i*u-l*n);a[9]=-(c*(n*C-u*y)-m*(d*C-f*y)+w*(d*u-f*n));a[10]=c*(i*C-l*y)-g*(d*C-f*y)+w*(d*l-f*i);a[11]=-(c*(i*u-l*n)-g*(d*u-f*n)+m*(d*l-f*i));a[12]=-(g*(n*D-s*y)-m*(i*D-k*y)+w*(i*s-k*n));a[13]=c*(n* D-s*y)-m*(d*D-e*y)+w*(d*s-e*n);a[14]=-(c*(i*D-k*y)-g*(d*D-e*y)+w*(d*k-e*i));a[15]=c*(i*s-k*n)-g*(d*s-e*n)+m*(d*k-e*i);return a},XC:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],i=a[6],k=a[7],l=a[8],m=a[9],n=a[10],s=a[11],u=a[12],w=a[13],y=a[14],a=a[15];return(b*g-c*f)*(n*a-s*y)-(b*i-d*f)*(m*a-s*w)+(b*k-e*f)*(m*y-n*w)+(c*i-d*g)*(l*a-s*u)-(c*k-e*g)*(l*y-n*u)+(d*k-e*i)*(l*w-m*u)},multiply:function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],l=b[6],m=b[7],n=b[8],s=b[9],u=b[10],w= b[11],y=b[12],D=b[13],C=b[14],b=b[15],F=c[0],z=c[1],A=c[2],E=c[3];a[0]=F*d+z*i+A*n+E*y;a[1]=F*e+z*k+A*s+E*D;a[2]=F*f+z*l+A*u+E*C;a[3]=F*g+z*m+A*w+E*b;F=c[4];z=c[5];A=c[6];E=c[7];a[4]=F*d+z*i+A*n+E*y;a[5]=F*e+z*k+A*s+E*D;a[6]=F*f+z*l+A*u+E*C;a[7]=F*g+z*m+A*w+E*b;F=c[8];z=c[9];A=c[10];E=c[11];a[8]=F*d+z*i+A*n+E*y;a[9]=F*e+z*k+A*s+E*D;a[10]=F*f+z*l+A*u+E*C;a[11]=F*g+z*m+A*w+E*b;F=c[12];z=c[13];A=c[14];E=c[15];a[12]=F*d+z*i+A*n+E*y;a[13]=F*e+z*k+A*s+E*D;a[14]=F*f+z*l+A*u+E*C;a[15]=F*g+z*m+A*w+E*b;return a}}; Sj.Zm=Sj.multiply; Sj.translate=function(a,b,c){var d=c[0],e=c[1],c=c[2],f,g,i,k,l,m,n,s,u,w,y,D;if(b===a){a[12]=b[0]*d+b[4]*e+b[8]*c+b[12];a[13]=b[1]*d+b[5]*e+b[9]*c+b[13];a[14]=b[2]*d+b[6]*e+b[10]*c+b[14];a[15]=b[3]*d+b[7]*e+b[11]*c+b[15]}else{f=b[0];g=b[1];i=b[2];k=b[3];l=b[4];m=b[5];n=b[6];s=b[7];u=b[8];w=b[9];y=b[10];D=b[11];a[0]=f;a[1]=g;a[2]=i;a[3]=k;a[4]=l;a[5]=m;a[6]=n;a[7]=s;a[8]=u;a[9]=w;a[10]=y;a[11]=D;a[12]=f*d+l*e+u*c+b[12];a[13]=g*d+m*e+w*c+b[13];a[14]=i*d+n*e+y*c+b[14];a[15]=k*d+s*e+D*c+b[15]}return a}; Sj.scale=function(a,b,c){var d=c[0],e=c[1],c=c[2];a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a}; Sj.rotate=function(a,b,c,d){var e=d[0],f=d[1],d=d[2],g=Math.sqrt(e*e+f*f+d*d),i,k,l,m,n,s,u,w,y,D,C,F,z,A,E,G,P,S,ba,ca;if(Math.abs(g)<fk)return p;g=1/g;e=e*g;f=f*g;d=d*g;i=Math.sin(c);k=Math.cos(c);l=1-k;c=b[0];g=b[1];m=b[2];n=b[3];s=b[4];u=b[5];w=b[6];y=b[7];D=b[8];C=b[9];F=b[10];z=b[11];A=e*e*l+k;E=f*e*l+d*i;G=d*e*l-f*i;P=e*f*l-d*i;S=f*f*l+k;ba=d*f*l+e*i;ca=e*d*l+f*i;e=f*d*l-e*i;f=d*d*l+k;a[0]=c*A+s*E+D*G;a[1]=g*A+u*E+C*G;a[2]=m*A+w*E+F*G;a[3]=n*A+y*E+z*G;a[4]=c*P+s*S+D*ba;a[5]=g*P+u*S+C*ba;a[6]= m*P+w*S+F*ba;a[7]=n*P+y*S+z*ba;a[8]=c*ca+s*e+D*f;a[9]=g*ca+u*e+C*f;a[10]=m*ca+w*e+F*f;a[11]=n*ca+y*e+z*f;if(b!==a){a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}return a};Sj.cO=function(a,b,c){var d=Math.sin(c),c=Math.cos(c),e=b[4],f=b[5],g=b[6],i=b[7],k=b[8],l=b[9],m=b[10],n=b[11];if(b!==a){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[4]=e*c+k*d;a[5]=f*c+l*d;a[6]=g*c+m*d;a[7]=i*c+n*d;a[8]=k*c-e*d;a[9]=l*c-f*d;a[10]=m*c-g*d;a[11]=n*c-i*d;return a}; Sj.dO=function(a,b,c){var d=Math.sin(c),c=Math.cos(c),e=b[0],f=b[1],g=b[2],i=b[3],k=b[8],l=b[9],m=b[10],n=b[11];if(b!==a){a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[0]=e*c-k*d;a[1]=f*c-l*d;a[2]=g*c-m*d;a[3]=i*c-n*d;a[8]=e*d+k*c;a[9]=f*d+l*c;a[10]=g*d+m*c;a[11]=i*d+n*c;return a}; Sj.eO=function(a,b,c){var d=Math.sin(c),c=Math.cos(c),e=b[0],f=b[1],g=b[2],i=b[3],k=b[4],l=b[5],m=b[6],n=b[7];if(b!==a){a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[0]=e*c+k*d;a[1]=f*c+l*d;a[2]=g*c+m*d;a[3]=i*c+n*d;a[4]=k*c-e*d;a[5]=l*c-f*d;a[6]=m*c-g*d;a[7]=n*c-i*d;return a}; Sj.I2=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=d+d,k=e+e,l=f+f,b=d*i,m=d*k,d=d*l,n=e*k,e=e*l,f=f*l,i=g*i,k=g*k,g=g*l;a[0]=1-(n+f);a[1]=m+g;a[2]=d-k;a[3]=0;a[4]=m-g;a[5]=1-(b+f);a[6]=e+i;a[7]=0;a[8]=d+k;a[9]=e-i;a[10]=1-(b+n);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a}; Sj.gX=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,i=d+d,k=e+e,c=c*g,l=d*g,d=d*i,m=e*g,n=e*i,e=e*k,g=f*g,i=f*i,f=f*k;a[0]=1-d-e;a[1]=l+f;a[2]=m-i;a[3]=0;a[4]=l-f;a[5]=1-c-e;a[6]=n+g;a[7]=0;a[8]=m+i;a[9]=n-g;a[10]=1-c-d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};Sj.K2=function(a,b,c,d,e,f,g){var i=1/(c-b),k=1/(e-d),l=1/(f-g);a[0]=f*2*i;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=f*2*k;a[6]=0;a[7]=0;a[8]=(c+b)*i;a[9]=(e+d)*k;a[10]=(g+f)*l;a[11]=-1;a[12]=0;a[13]=0;a[14]=g*f*2*l;a[15]=0;return a}; Sj.DZ=function(a,b,c){var b=1/Math.tan(b/2),d=1/-999.99;a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1000.01*d;a[11]=-1;a[12]=0;a[13]=0;a[14]=20*d;a[15]=0};Sj.j4=function(a,b,c,d,e,f,g){var i=1/(b-c),k=1/(d-e),l=1/(f-g);a[0]=-2*i;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*k;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*l;a[11]=0;a[12]=(b+c)*i;a[13]=(e+d)*k;a[14]=(g+f)*l;a[15]=1;return a}; Sj.S3=function(a,b,c,d){var e,f,g,i,k,l,m,n,s=b[0],u=b[1],b=b[2];g=d[0];i=d[1];f=d[2];m=c[0];d=c[1];e=c[2];if(Math.abs(s-m)<fk&&Math.abs(u-d)<fk&&Math.abs(b-e)<fk)return Sj.Qm(a);c=s-m;d=u-d;m=b-e;n=1/Math.sqrt(c*c+d*d+m*m);c=c*n;d=d*n;m=m*n;e=i*m-f*d;f=f*c-g*m;g=g*d-i*c;if(n=Math.sqrt(e*e+f*f+g*g)){n=1/n;e=e*n;f=f*n;g=g*n}else g=f=e=0;i=d*g-m*f;k=m*e-c*g;l=c*f-d*e;if(n=Math.sqrt(i*i+k*k+l*l)){n=1/n;i=i*n;k=k*n;l=l*n}else l=k=i=0;a[0]=e;a[1]=i;a[2]=c;a[3]=0;a[4]=f;a[5]=k;a[6]=d;a[7]=0;a[8]=g;a[9]= l;a[10]=m;a[11]=0;a[12]=-(e*s+f*u+g*b);a[13]=-(i*s+k*u+l*b);a[14]=-(c*s+d*u+m*b);a[15]=1;return a};Sj.xn=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"}; Sj.MD=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof exports&&(exports.Z3=Sj);var pk={create:function(){var a=new gk(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}}; pk.D4=function(){var a=lk.create(),b=lk.tg(1,0,0),c=lk.tg(0,1,0);return function(d,e,f){var g=lk.Ls(e,f);if(g<-0.999999){lk.fx(a,b,e);lk.length(a)<1.0E-6&&lk.fx(a,c,e);lk.normalize(a,a);pk.i_(d,a);return d}if(g>0.999999){d[0]=0;d[1]=0;d[2]=0;d[3]=1;return d}lk.fx(a,e,f);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=1+g;return pk.normalize(d,d)}}(); pk.G4=function(){var a=ok.create();return function(b,c,d,e){a[0]=d[0];a[3]=d[1];a[6]=d[2];a[1]=e[0];a[4]=e[1];a[7]=e[2];a[2]=-c[0];a[5]=-c[1];a[8]=-c[2];return pk.normalize(b,pk.fX(b,a))}}();pk.ji=Rj.ji;pk.tg=Rj.tg;pk.copy=Rj.copy;pk.set=Rj.set;pk.Qm=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};pk.i_=function(a,b){var c=Math.PI,c=c*0.5,d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c)};pk.add=Rj.add; pk.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],b=b[3],g=c[0],i=c[1],k=c[2],c=c[3];a[0]=d*c+b*g+e*k-f*i;a[1]=e*c+b*i+f*g-d*k;a[2]=f*c+b*k+d*i-e*g;a[3]=b*c-d*g-e*i-f*k;return a};pk.Zm=pk.multiply;pk.scale=Rj.scale;pk.cO=function(a,b,c){var c=c*0.5,d=b[0],e=b[1],f=b[2],b=b[3],g=Math.sin(c),c=Math.cos(c);a[0]=d*c+b*g;a[1]=e*c+f*g;a[2]=f*c-e*g;a[3]=b*c-d*g;return a}; pk.dO=function(a,b,c){var c=c*0.5,d=b[0],e=b[1],f=b[2],b=b[3],g=Math.sin(c),c=Math.cos(c);a[0]=d*c-f*g;a[1]=e*c+b*g;a[2]=f*c+d*g;a[3]=b*c-e*g;return a};pk.eO=function(a,b,c){var c=c*0.5,d=b[0],e=b[1],f=b[2],b=b[3],g=Math.sin(c),c=Math.cos(c);a[0]=d*c+e*g;a[1]=e*c-d*g;a[2]=f*c+b*g;a[3]=b*c-f*g;return a};pk.c2=function(a,b){var c=b[0],d=b[1],e=b[2];a[0]=c;a[1]=d;a[2]=e;a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return a};pk.Ls=Rj.Ls;pk.hy=Rj.hy; pk.P4=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],b=b[3],i=c[0],k=c[1],l=c[2],c=c[3],m,n,s;n=e*i+f*k+g*l+b*c;if(n<0){n=-n;i=-i;k=-k;l=-l;c=-c}if(1-n>1.0E-6){m=Math.acos(n);s=Math.sin(m);n=Math.sin((1-d)*m)/s;d=Math.sin(d*m)/s}else n=1-d;a[0]=n*e+d*i;a[1]=n*f+d*k;a[2]=n*g+d*l;a[3]=n*b+d*c;return a};pk.xp=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,g=g?1/g:0;a[0]=-c*g;a[1]=-d*g;a[2]=-e*g;a[3]=f*g;return a};pk.i2=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a}; pk.length=Rj.length;pk.UE=pk.length;pk.Xk=Rj.Xk;pk.XF=pk.Xk;pk.normalize=Rj.normalize;pk.fX=function(a,b){var c=b[0]+b[4]+b[8];if(c>0){c=Math.sqrt(c+1);a[3]=0.5*c;c=0.5/c;a[0]=(b[7]-b[5])*c;a[1]=(b[2]-b[6])*c;a[2]=(b[3]-b[1])*c}else{var d=0;b[4]>b[0]&&(d=1);b[8]>b[d*3+d]&&(d=2);var e=(d+1)%3,f=(d+2)%3,c=Math.sqrt(b[d*3+d]-b[e*3+e]-b[f*3+f]+1);a[d]=0.5*c;c=0.5/c;a[3]=(b[f*3+e]-b[e*3+f])*c;a[e]=(b[e*3+d]+b[d*3+e])*c;a[f]=(b[f*3+d]+b[d*3+f])*c}return a}; pk.xn=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof exports&&(exports.w4=pk);function qk(a,b){this.Kf=a;this.Iq=b||2;this.TA=a-this.Iq;this.vc=[];this.Mg=[];this.BE()}x.extend(qk.prototype,{BE:function(){var a,b;this.vc.push(0,-20,0);for(ch=0;360>ch;ch+=6)a=Math.cos(Pb(ch))*this.Kf,b=Math.sin(Pb(ch))*this.Kf,this.vc.push(a,-20,b)},AE:function(){for(var a=(this.vc.length-3)/3,b=1;b<a;b++)this.Mg.push(0,b,b+1);this.Mg.push(0,b,1)},$D:function(){0==this.Mg.length&&this.AE();return this.Mg}});function rk(a,b){this.Kf=a;this.Iq=b||2;this.TA=a-this.Iq;this.vc=[];this.Mg=[];this.BE()} x.extend(rk.prototype,{BE:function(){for(var a,b,c=0;360>c;c+=6)a=Math.cos(Pb(c))*this.TA,b=Math.sin(Pb(c))*this.TA,this.vc.push(a,-20,b);for(c=0;360>c;c+=6)a=Math.cos(Pb(c))*this.Kf,b=Math.sin(Pb(c))*this.Kf,this.vc.push(a,-20,b)},AE:function(){var a=this.vc.length/3/2;for(ch=0;ch<a-1;ch++)this.Mg.push(ch,ch+a+1,ch+a),this.Mg.push(ch,ch+1,ch+a+1);this.Mg.push(ch,a,ch+a);this.Mg.push(ch,0,a)},$D:function(){0==this.Mg.length&&this.AE();return this.Mg}});function sk(a){this.Kf=a;this.Vd=Math.pow(2,4);this.Sr=this.Vd/2;this.vc=[];this.rA=[];a=360/this.Vd;this.RJ=Math.cos(Pb(3*a))*this.Kf;this.SJ=Math.cos(Pb(2*a))*this.Kf;this.TJ=Math.cos(Pb(1*a))*this.Kf;this.GY()} x.extend(sk.prototype,{GY:function(){if(!(0<this.vc.length))for(var a=this.Kf,b=[],c=64/this.Vd,d=64/c,e=[],f=0,g=0,i,k=0;33>k;k++)for(var l=Math.cos(Pb(5.625*k-90))*a,l=Math.round(100*l)/100,m=Math.sin(Pb(5.625*k-90))*a,m=Math.round(100*m)/100,f=Math.floor(k/c),n=0;64>n;n++){var s=Math.cos(Pb(5.625*n))*l,u=Math.sin(Pb(5.625*n))*l,s=Math.round(100*s)/100,u=Math.round(100*u)/100;b.push(s,m,u);g=Math.floor(n/c);i=g+f*d;f<this.Sr&&(this.vc[i]||(this.vc[i]=[]),this.vc[i].push(s,m,u));if(0<f&&0==k%c){var w= g+(f-1)*d;this.vc[w].push(s,m,u);0<n&&0==n%c&&this.vc[w-1]&&this.vc[w-1].push(s,m,u);63==n&&this.vc[w].push(e[0],e[1],e[2])}0==g&&0==n&&(e=[s,m,u]);0<n&&0==n%c&&this.vc[i-1]&&this.vc[i-1].push(s,m,u);f<this.Sr&&63==n&&this.vc[i].push(e[0],e[1],e[2])}},FY:function(){for(var a=64/this.Vd,b=a+1,c=0;c<a;c++)for(var d=0;d<a;d++){var e=c*b,f=e+d+1;this.rA.push(e+d,f,e+d+1+b);f=e+d+1+b;this.rA.push(e+d,f,e+b+d)}return this.rA},kX:function(a,b,c){var d=this.vc[Math.round(this.vc.length/2)];if(d){for(var e= [],f=Math.pow(2,5-a),b=b%f,c=c%f,g=64/this.Vd,i=1/g,k=1/(32/this.Sr),l=0;l<d.length/3;l++){var m=l%(g+1)*i,n=Math.floor(l/(g+1))*k,m=m/f+1*b/f,n=n/f+1*c/f;1===a&&(n*=2);e.push(m,n)}return e}},xX:function(a){var b=0,c=0,c=a[0],b=a[1],d=a[2],a=Math.round(180*Math.atan(Math.abs(d)/Math.abs(c))/Math.PI);0<c?0>d&&(a=360-a):a=0<d?180-a:180+a;c=b>this.TJ?7:b>this.SJ?6:b>this.RJ?5:0<b?4:b>-this.RJ?3:b>-this.SJ?2:b>-this.TJ?1:0;b=Math.floor(a/22.5);return[b,c,b+c*(64/(64/this.Vd))]}});function Kj(a){this.P=a;this.oe=this.jb=this.Xa=this.cj=p;var b=this;this.es=new Tj(6,{Po:function(a){for(var d=0;d<a.length;d++)if(a[d])for(var e=0;e<a[d].length;e++)a[d][e]&&(b.jb.deleteTexture(a[d][e].iz),a[d][e].Ks=q)}});this.HJ=new Tj(32,{Po:function(a){a&&(a.sA=o,a.src="")}});this.LA=new Uj;this.Vd=16;this.Sr=8;this.Kf=500;this.Yj=this.dj=0;this.If=[Sj.create(),Sj.create()];this.Wh=Sj.create();this.mB=[Sj.create(),Sj.create()];this.Dr=Sj.create();this.kB=[];this.Yl=this.zo=this.nw=p;this.$r= {};this.bS();this.YB=0;this.qv=[p,p];this.MA=[p,p];this.lg=[];this.kg=J()?2:1;this.Ui()} x.extend(Kj.prototype,{bS:function(){this.tl=[];for(var a=2;5>=a;a++)this.tl[a]={cols:Math.pow(2,a-1),rows:Math.pow(2,a-1)/2};this.tl[1]={cols:1,rows:1}},Ui:function(){this.eA();this.jb=this.Xa.getContext("webgl",{alpha:q});this.ww=dk.get(this.jb,this.P.ba);this.QA();this.EU();this.vA();this.wA();this.WT();this.ww.zE()},eA:function(){var a=this.Xa=H("canvas"),b=this.Xa.style,c=this.P.C,d=c.clientWidth,c=c.clientHeight;b.width=d+"px";b.height=c+"px";this.dj=a.width=d*this.kg;this.Yj=a.height=c*this.kg; this.P.ci.appendChild(this.Xa)},EU:function(){var a=this.jb,b=this.Xa;a.clearColor(0,0,0,1);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.depthMask(o);a.viewport(0,0,b.width,b.height)},Qk:function(){var a=this.P.C,b=a.clientWidth,a=a.clientHeight;this.Xa.style.width=b+"px";this.Xa.style.height=a+"px";this.dj=this.Xa.width=b*this.kg;this.Yj=this.Xa.height=a*this.kg;this.cr=p;b=this.Xa;this.jb.viewport(0,0,b.width,b.height)},QA:function(){var a=this.jb,b= this.oe=a.createProgram(),c=this.Al("attribute vec3 aVertexPosition;\\nattribute vec2 aVertexTextureCoordBack;\\nattribute vec2 aVertexTextureCoord;\\nvarying mediump vec2 vTextureCoordBack;\\nvarying mediump vec2 vTextureCoord;\\nuniform mat4 uMVMatrix;\\nuniform mat4 uPMatrix;\\nvoid main(void) {\\n    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\\n    vTextureCoordBack = aVertexTextureCoordBack;\\n    vTextureCoord = aVertexTextureCoord;\\n}",a.VERTEX_SHADER),d=this.Al("precision mediump float;\\nvarying vec2 vTextureCoordBack;\\nvarying vec2 vTextureCoord;\\nuniform sampler2D uSamplerBack;\\nuniform sampler2D uSampler;\\nuniform bool uDrawThumb;\\nuniform bool uDrawBack;\\nuniform float uAlpha;\\nvoid main(void) {\\n    if (uDrawThumb) {\\n        gl_FragColor = texture2D(uSamplerBack, vTextureCoordBack);\\n        return;\\n    }\\n    if (uAlpha == 1.0) {\\n        gl_FragColor = texture2D(uSampler, vTextureCoord);\\n        return;\\n    }\\n    if (uDrawBack) {\\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha + texture2D(uSamplerBack, vTextureCoordBack) * (1.0 - uAlpha);\\n    } else {\\n        vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\\n        gl_FragColor =  vec4(textureColor.rgb, textureColor.a * uAlpha);\\n    }\\n}", a.FRAGMENT_SHADER);a.attachShader(b,c);a.attachShader(b,d);a.bindAttribLocation(b,0,"aVertexPosition");a.linkProgram(b)},Al:function(a,b){var c=this.jb,d=c.createShader(b);c.shaderSource(d,a);c.compileShader(d);return d},WT:function(){var a=new sk(this.Kf),b=a.FY();this.$r={BO:a,aX:b,$W:a.vc}},setData:function(a){a!==p&&(this.Ll=this.ea?this.ea.id:p,this.xB=this.ea||p);(this.ea=a)&&this.es.setData(a.id,[])},va:function(a,b){if(this.ea){this.Ea=a;this.cf=b;var c=this.Xa;this.cj||(this.cj=this.P.ga()); this.cr||(this.cr=180/Math.pow(2,this.cj),this.cV=c.width/c.height,Sj.DZ(this.Wh,Pb(this.cr),this.cV),Sj.xp(this.Dr,this.Wh));this.Sz(0);c=this.xA(0);this.qv[0]=c[0];this.MA[0]=c[1];this.pT();this.as()}},Sz:function(a){Sj.Qm(this.If[a]);Sj.rotate(this.If[a],this.If[a],Pb(this.Ea.pitch),[-1,0,0]);var b=this.ea.tiles.dirNorth;1==a&&this.xB&&(b=this.xB.tiles.dirNorth);Sj.rotate(this.If[a],this.If[a],Pb(b+this.Ea.heading+90),[0,1,0]);Sj.xp(this.mB[a],this.If[a])},Xj:function(a,b,c){var d=this.dj,e=this.Yj, f=Rj.create(),g=this.Dr,c=this.mB[c],a=Rj.tg(2*a/d-1,1-2*b/e,-1,1);Sj.multiply(f,g,a);Sj.multiply(f,c,f);b=this.Kf;g=200*f[0];a=200*f[1];f=200*f[2];b=Math.sqrt(-(-b*b)/(g*g+a*a+f*f));return this.$r.BO.xX([g*b,a*b,f*b])},mI:function(a,b,c,d){var e=this.Yj,b=Rj.tg(a,b,c,1),a=Rj.create();Sj.multiply(a,this.If[d],b);b=Rj.tg(a[0],a[1],a[2],a[3]);Sj.multiply(a,this.Wh,b);if(0!==a[3])return d=(1-lk.tg(a[0]/a[3],a[1]/a[3],a[2]/a[3])[1])*e/2,0<a[3]&&0<d&&d<e?o:q},Oc:function(a,b,c){var c=c||{},d=c.Hp||q,e= c.NZ||p;this.ro=this.cf;this.cf=b;this.cr=p;var f=this,g=this.cj,i=a-g;f.or&&(f.or.stop(),f.or=p);d?(f.cj=a,f.eV=q,f.va(f.Ea,b)):f.or=new ub({duration:600,Hc:60,hc:vb.iL,va:function(a){if(a!=0){f.cr=p;f.cj=g+i*a;a<0.5?f.va(f.Ea,f.ro):f.va(f.Ea,b);e&&e(f.cj)}},finish:function(){f.or=p;f.cj=a;f.eV=q;f.P.dispatchEvent(new N("onzoom_changed"))},Pt:function(){f.P.dispatchEvent(new N("onzoom_changed"));f.or=p}})},pT:function(){var a=this;this.$I(0,0,1,function(){a.Tg||a.AI()})},AI:function(){for(var a= this.MA[0],b=a[0],c=a[1],d=a[3],a=a[2];a<=d;a++){var e=b,f=c;"number"===typeof this.NA&&(a>=this.NA&&a<=this.nI)&&(e=0,f=this.tl[this.cf].cols-1);for(;e<=f;e++)this.$I(e,a)}},$I:function(a,b,c,d){var c=c||this.cf,e=this.tl[c].cols,f=this.tl[c].rows,g=this,a=g.AB(a,c);0>b&&(a=g.AB(e-1-a,c),b=0);b>f-1&&(a=g.AB(e-1-a,c),b=f-1);var i=a+b*e,k=g.es.getData(g.ea.id);k[c]||(k[c]=[]);k[c][i]||(k[c][i]={});var l=k[c][i];l.loaded?(g.wJ(c)&&g.CJ(),d&&d()):(l.index=i,l.loaded=q,l.xZ=g.ea.id,g.oT(a,b,c,function(a){if(l.xZ== g.ea.id){l.loaded=o;var b=k[c][i];if(!b.Ks){g.DU(b,a,c);if(c>1)b.cm={duration:300,startTime:Date.now(),MC:0,Uo:1};b.Ks=o}g.wJ(c)&&g.CJ();d&&d();g.as()}}))},wJ:function(a){return 1===a&&this.Ll&&this.P.MJ?o:q},pO:da("yT"),AB:function(a,b){for(var c=a,d=this.tl[b||this.cf].cols;0>c;)c+=d;return c%d},zf:function(){this.YB--;0===this.YB&&this.P.dispatchEvent(new N("ontilesloaded"))},as:function(){this.cv&&(clearTimeout(this.cv),this.cv=p);var a=this;this.cv=setTimeout(function(){cancelAnimationFrame(a.Uv); a.Uv=p;a.cv=p},300);this.Uv||this.Tv()},Tv:function(){var a=this;a.Uv=requestAnimationFrame(function(){a.Tv()});var b=this.oe;this.jb.useProgram(b);var c=this.ww;c.Yo(b.En);c.Yo(b.oP);c.Yo(b.Fu);c.cD();b=q;this.Tg?this.aU():b=this.FB(0);if(b&&!this.Tg)for(b=0;b<this.lg.length;b++)this.lg[b].Tv(this.Wh,this.If[0],this.Dr,this.mB[0])},FB:function(a,b){if(!this.ea)return q;var c=this.qv[a];if(!c)return q;var d=0==a?this.ea.id:this.Ll;if(!d)return q;b&&Sj.translate(this.If[a],this.kB[a],b);var e=c[0], f=c[1],g=c[2],c=c[3];this.Tg&&0==a&&(e-=2,f+=2,g-=2,c+=2,g=0>g?0:g);d=this.es.getData(d);if(!d)return q;for(;g<=c;g++){var i=e,k=f;"number"===typeof this.pk&&(g>=this.pk&&g<=this.Zl)&&(i=0,k=this.Vd-1);for(;i<=k;i++){for(var l=i;0>l;)l+=this.Vd;var l=l%this.Vd,m=this.ql(l,g)[2],n=this.ql(l,g,this.ro)[2],s=this.ql(l,g,1)[2],u=p,w=p,y=1;d[this.cf]&&(d[this.cf][m]&&d[this.cf][m].Ks)&&(u=m);d[this.ro]&&d[this.ro][n]&&d[this.ro][n].Ks?(w=n,y=this.ro):d[1][s]&&d[1][s].Ks&&(w=s);if(u===p&&w===p)return q; m=this.jb;n=this.oe;s=this.cf;this.Tg&&1==a?(m.uniform1i(n.eL,q),u===p&&(u=w,s=1),w=p):m.uniform1i(n.eL,o);this.hT(u,s,w,y,a);this.CU(l,g,s,y);this.LB(a);this.NR()}}return o},ql:function(a,b,c){var c=c||this.cf,d=Math.pow(2,5-c),a=Math.floor(a/d),b=Math.floor(b/d),b=this.tl[c].rows-b-1;return[a,b,a+b*this.Vd/d]},DU:function(a,b,c){if(a){var d=this.jb;1===c?d.activeTexture(d.TEXTURE0):d.activeTexture(d.TEXTURE1);a.iz=d.createTexture();d.bindTexture(d.TEXTURE_2D,a.iz);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL, o);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,b);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR)}},hT:function(a,b,c,d,e){var f=0==e?this.ea.id:this.Ll;if(f){var g=this.es.getData(f),f=this.jb,i=this.oe;a===p?f.uniform1i(i.fL,o):f.uniform1i(i.fL,q);var k=p;g[d]&&g[d][c]&&(f.activeTexture(f.TEXTURE0), k=g[d][c].iz,f.bindTexture(f.TEXTURE_2D,k),f.uniform1i(i.YZ,0));if("number"===typeof a){f.activeTexture(f.TEXTURE1);f.bindTexture(f.TEXTURE_2D,g[b][a].iz);f.uniform1i(i.ZZ,1);a=g[b][a];"number"!=typeof a.Uo&&(a.Uo=1);if(1==e&&(!a.cm||0!=a.cm.Uo))a.cm={duration:400,startTime:this.fw,MC:1,Uo:0},a.Uo=0;a.cm?(e=a.cm,b=(Date.now()-e.startTime)/e.duration,0==e.MC?(e=b,1<e&&(e=1,a.cm=p)):(e=e.MC*(1-b),0>e&&(e=0,a.cm=p)),f.uniform1f(i.alpha,e)):f.uniform1f(i.alpha,a.Uo)}}},CU:function(a,b,c,d){var e=this.RS(a, b),f=this.$r.aX,c=this.fI(a,b,c),a=this.fI(a,b,d),b=this.jb;this.nw||(this.nw=b.createBuffer());b.bindBuffer(b.ARRAY_BUFFER,this.nw);b.bufferData(b.ARRAY_BUFFER,new Float32Array(e),b.STATIC_DRAW);this.zo||(this.zo=b.createBuffer(),this.zo.mG=f.length,b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.zo),b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(f),b.STATIC_DRAW));this.bC||(this.bC=b.createBuffer());b.bindBuffer(b.ARRAY_BUFFER,this.bC);b.bufferData(b.ARRAY_BUFFER,new Float32Array(a),b.STATIC_DRAW); c&&(this.Yl||(this.Yl=b.createBuffer()),b.bindBuffer(b.ARRAY_BUFFER,this.Yl),b.bufferData(b.ARRAY_BUFFER,new Float32Array(c),b.STATIC_DRAW))},NR:function(){var a=this.jb,b=this.oe;a.bindBuffer(a.ARRAY_BUFFER,this.nw);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.zo);a.vertexAttribPointer(b.En,3,a.FLOAT,q,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.bC);a.vertexAttribPointer(b.oP,2,a.FLOAT,q,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.Yl);a.vertexAttribPointer(b.Fu,2,a.FLOAT,q,0,0);a.drawElements(a.TRIANGLES,this.zo.mG, a.UNSIGNED_SHORT,0)},RS:function(a,b){return this.$r.$W[a+b*(64/(64/this.Vd))]},fI:function(a,b,c){return this.$r.BO.kX(c||this.cf,a,b)},vA:function(){var a=this.oe,b=this.jb;a.Qt=b.getUniformLocation(a,"uPMatrix");a.Nt=b.getUniformLocation(a,"uMVMatrix");a.fL=b.getUniformLocation(a,"uDrawThumb");a.eL=b.getUniformLocation(a,"uDrawBack");a.alpha=b.getUniformLocation(a,"uAlpha");a.YZ=b.getUniformLocation(a,"uSamplerBack");a.ZZ=b.getUniformLocation(a,"uSampler")},wA:function(){var a=this.oe,b=this.jb; a.En=b.getAttribLocation(a,"aVertexPosition");a.oP=b.getAttribLocation(a,"aVertexTextureCoordBack");a.Fu=b.getAttribLocation(a,"aVertexTextureCoord")},LB:function(a){var b=this.oe,c=this.jb;c.uniformMatrix4fv(b.Qt,q,this.Wh);c.uniformMatrix4fv(b.Nt,q,this.If[a])},Mq:function(a,b,c,d){return a+"_"+b+"_"+c+"_"+d},oT:function(a,b,c,d){var e=this.Mq(this.ea.id,a,b,c),f=this.HJ.getData(e);this.YB++;if(f)f.yr&&(d(f),this.zf());else{f=this.LA.Dx();f.crossOrigin="anonymous";f.yr=q;var g=this;f.onload=function(){-1!= this.src.indexOf("pos=0_0&z=1")&&g.P.dispatchEvent(new N("onthumbnail_complete"));d(this);g.zf();this.yr=o};f.src=this.ea.tiles.getTilesUrl(this.ea.id,new R(a,b),c);this.HJ.setData(e,f)}},xA:function(a){var b=this.dj,c=this.Yj,d,e,f,g,i,k=this.Xj(0,0,a);d=k[0];g=k[1];k=this.Xj(b/2,0,a);k[1]>g&&(g=k[1]);k=this.Xj(b,0,a);e=k[0];e<d&&(e+=this.Vd);i=k[1];k=this.Xj(0,c/2,a);k[0]>e&&(k[0]-=this.Vd);k[0]<d&&(d=k[0]);k=this.Xj(b,c/2,a);k[0]<d&&(k[0]+=this.Vd);k[0]>e&&(e=k[0]);k=this.Xj(0,c,a);k[0]>e&&(k[0]-= this.Vd);k[0]<d&&(d=k[0]);f=k[1];k=this.Xj(b/2,c,a);k[1]<f&&(f=k[1]);k=this.Xj(b,c,a);k[0]<d&&(k[0]+=this.Vd);k[0]>e&&(e=k[0]);b=k[1];this.mI(0,100,0,a)?(this.Zl=this.Sr-1,this.pk=i):this.mI(0,-100,0,a)?(this.pk=0,this.Zl=b):this.nI=this.NA=this.Zl=this.pk=p;this.Zl!=p&&g<this.Zl&&(g=this.Zl);this.pk!=p&&f>this.pk&&(f=this.pk);b=this.ql(d,g);c=this.ql(e,f);a=b[0];i=c[0];b=b[1];c=c[1];this.NA=this.ql(0,this.pk)[1];this.nI=this.ql(0,this.Zl)[1];return[[d,e,f,g],[a,i,b,c]]},iV:function(a){this.lg.push(a)}, CJ:function(){if(!this.Tg&&(this.Sz(1),this.kB[0]=Sj.ji(this.If[0]),this.kB[1]=Sj.ji(this.If[1]),this.qv[1]=this.xA(1)[0],this.Tg=o,this.kA=160,this.lA=120,"number"==typeof this.P.AH)){var a=Math.pow(this.P.AH,0.25);this.kA*=a;this.lA*=a}},TI:function(){this.Tg=q;this.fw=this.Ll=p;this.Sz(0);var a=this.xA(0);this.qv[0]=a[0];this.MA[0]=a[1];this.AI();this.as()},aU:function(){this.fw||(this.fw=Date.now());this.as();this.tR=Date.now();var a=this.tR-this.fw;if(400<a)this.TI();else{var a=a/400,a=-a*(a- 2),b=this.xB.links[this.yT];if(b){var c=b.dir+this.ea.tiles.dirNorth;360<c&&(c%=360);var d=this.kA*(1-a),e=Math.cos(Pb(c))*d,c=Math.sin(Pb(c))*d;try{this.FB(0,[e,0,c])}catch(f){}d=this.lA*a;e=Math.cos(Pb(b.zh))*d;c=Math.sin(Pb(b.zh))*d;try{this.FB(1,[-e,0,-c])}catch(g){}}else this.TI()}},VC:function(){cancelAnimationFrame(this.Uv);this.es.clear()}});function Lj(a,b){this.P=a;this.Xa=b;this.dj=b.width;this.Yj=b.height;this.jb=b.getContext("webgl",{alpha:q});this.ww=dk.get(this.jb,this.P.ba);this.ea=this.oe=p;this.Pa=q;this.Ui();this.ao=this.$j=o;this.Un=[0,-20,0];this.kg=J()?2:1;this.Pn=this.Qn=this.On=p;this.Ud={};a.bB=this;this.wo=a.lg.Bd;this.Xd=new T}var tk=[10,-20,30,10,-20,10,-10,-20,10,-10,-20,30],uk=[0,0,0,1,1,1,1,0],vk=[2.2,-20,22.3,2.2,-20,13.7,-2.2,-20,13.7,-2.2,-20,22.3],wk=[0,0,0,0.5,0.25,0.5,0.25,0]; x.extend(Lj.prototype,{Ui:function(){this.pH=new qk(8.5);this.jJ=new rk(10,1.5);this.qT();this.QA();this.cT();this.ca();this.vA();this.wA()},qT:function(){var a=new Image,b=this;a.crossOrigin="anonymous";a.onload=function(){this.yr=o;b.On=b.jb.createTexture();b.RA(b.On,this)};a.src="http://map.baidu.com/res_mobile2/images/link-arrow-shadow.png";a=new Image;a.crossOrigin="anonymous";a.onload=function(){this.yr=o;b.Qn=b.jb.createTexture();b.RA(b.Qn,this)};a.src="http://map.baidu.com/res_mobile2/images/link-arrow.png"; a=new Image;a.crossOrigin="anonymous";a.onload=function(){this.yr=o;b.Pn=b.jb.createTexture();b.RA(b.Pn,this)};a.src="http://map.baidu.com/res_mobile2/images/dir-texture.png"},QA:function(){var a=this.jb,b=this.oe=a.createProgram(),c=this.Al("attribute vec3 aVertexPosition;\\nuniform mat4 uMVMatrix;\\nuniform mat4 uPMatrix;\\nvoid main(void) {\\n    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\\n}",a.VERTEX_SHADER),d=this.Al("precision mediump float;\\nuniform float uColor;\\nuniform float uAlpha;\\nvoid main(void) {\\n    gl_FragColor = vec4(uColor, uColor, uColor, 1.0) * uAlpha;\\n}", a.FRAGMENT_SHADER);a.attachShader(b,c);a.attachShader(b,d);a.linkProgram(b);a.useProgram(b)},cT:function(){var a=this.jb,b=this.wv=a.createProgram(),c=this.Al("attribute vec3 aVertexPosition;\\nattribute vec2 aVertexTextureCoord;\\nvarying highp vec2 vTextureCoord;\\nuniform mat4 uMVMatrix;\\nuniform mat4 uPMatrix;\\nvoid main(void) {\\n    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\\n    vTextureCoord = aVertexTextureCoord;\\n}",a.VERTEX_SHADER),d=this.Al("precision mediump float;\\nuniform sampler2D uSampler;\\nvarying highp vec2 vTextureCoord;\\nvoid main(void) {\\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\\n}", a.FRAGMENT_SHADER);a.attachShader(b,c);a.attachShader(b,d);a.linkProgram(b);a.useProgram(b)},Al:function(a,b){var c=this.jb,d=c.createShader(b);c.shaderSource(d,a);c.compileShader(d);return d},RA:function(a,b){var c=this.jb;c.activeTexture(c.TEXTURE2);c.bindTexture(c.TEXTURE_2D,a);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,q);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,b);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D, c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.bindTexture(c.TEXTURE_2D,p)},ca:function(){var a=this;x.M(this.Xa,"touchstart",function(b){if(!a.wo.Tg){a.JI=[a.P.Fa().heading,a.P.Fa().pitch];var c=b.changedTouches[0].pageX*a.kg,d=b.changedTouches[0].pageY*a.kg,e=p;a.$j&&(e=a.WH(c,d));a.K1=[c,d];a.jI=e;e!==p&&(a.P.dispatchEvent(new N("onlinktouchstart")),a.IU=setTimeout(function(){for(var d= a.ea.links,g=0;g<d.length;g++)if(d[g].id===e){a.uR=d[g].dir;a.lb=g;break}a.iI=o;a.Tl=o;a.P.Tl=o;d=[c,(b.changedTouches[0].pageY-60)*a.kg];a.Un=a.ir(d);a.vH=a.Rz(d);a.P.dispatchEvent(new N("onrefresh"));a.P.dispatchEvent(new N("onlongjumpstart"))},300))}});x.M(this.Xa,"touchend",function(){clearTimeout(a.IU);if(!a.wo.Tg)if(a.wo.pO(a.lb),a.Tl){a.Tl=q;a.P.Tl=q;a.iI=q;var b=a.uR,c=a.Rz();if(5>c)a.P.dispatchEvent(new N("onrefresh")),a.P.dispatchEvent(new N("onlongjumpcancel"));else{var d=a.ea.wh+Math.sin(Pb(b))* c,b=a.ea.xh+Math.cos(Pb(b))*c;a.P.dispatchEvent(new N("onrefresh"));a.P.dispatchEvent(new N("onlongjumpend"));d=new O(d,b);a.P.ta(a.Xd.rh(d),{qk:o})}}else d=a.P.Fa(),a.$U=1<Math.abs(Math.round(a.JI[0])-Math.round(d.heading))||1<Math.abs(Math.round(a.JI[1])-Math.round(d.pitch))?q:o,a.$U&&a.ea&&a.jI&&(a.P.dispatchEvent(new N("onlinkclick")),a.P.rc(a.jI,{qk:o}),a.P.dispatchEvent(new N("onlinktouchend")))});x.M(this.Xa,"touchmove",function(b){!a.wo.Tg&&a.Tl&&(a.vH=a.Rz([b.changedTouches[0].pageX*a.kg, (b.changedTouches[0].pageY-60)*a.kg]),a.P.dispatchEvent(new N("onrefresh")))})},WS:function(a,b){var c=a[2],d=[(b[0]+b[3]+b[6]+b[9])/4,(b[2]+b[5]+b[8]+b[11])/4];return 12>Math.abs(a[0]-d[0])&&12>Math.abs(c-d[1])?o:q},WH:function(a,b){if(!this.$j)return p;var c=this.lT[1],d=this.ir([a,b],c[1]);if(!d)return p;for(var e=0,f=this.ea.links.length;e<f;e++){var g=c.slice(12*e,12*e+12);if(this.WS(d,g)){this.lb=e;break}}return this.ea.links[e]?this.ea.links[e].id:p},eM:function(a,b){if(0===this.ea.links.length|| this.ao===q)return 0;var c=this.ir([a,b]),d=q;if(!c){d=this.P.ga();c=this.ir([a,b+50*Math.pow(2,d-2)]);if(!c)return 0;d=o}for(var e=this.P.Fa().heading;0>e;)e+=360;var e=this.XR(e%360),f=this.ea.links[e].zh,g=Math.sin(Pb(f)),f=Math.cos(Pb(f)),i=-g*c[0]+f*c[2];if(100<i||-100>i)return 0;c=(f*c[0]+g*c[2])/9;if(3.6>c)return 0;g=this.ea.links[e];f=this.NQ([this.ea.wh,0,this.ea.xh],[g.x,0,g.y]);this.wo.pO(e);if(c<f)return this.P.rc(g.id,{qk:o}),this.P.dispatchEvent(new N("onclickonroad")),c;300<c&&(c=300); d&&(c=300);e=this.ea.links[e].dir;d=this.ea.wh+Math.sin(Pb(e))*c;e=this.ea.xh+Math.cos(Pb(e))*c;this.P.dispatchEvent(new N("onclickonroad"));this.P.ta(this.Xd.rh(new O(d,e)),{qk:o});return c},Rz:function(a){var b=this.Un;a&&(b=this.ir(a));if(!b)return 300;var c=this.ea.links[this.lb].zh,d=Math.sin(Pb(c)),e=Math.cos(Pb(c)),a=Math.sin(Pb(-c)),c=Math.cos(Pb(-c)),f=e*b[0]+d*b[2],d=-d*b[0]+e*b[2];70<d&&(d=70);-70>d&&(d=-70);b[0]=c*f+a*d;b[2]=-a*f+c*d;this.Un[0]=b[0];this.Un[2]=b[2];b=f/9;return 300<b? 300:b},XR:function(a){for(var b=360,c=-1,d=0;d<this.ea.links.length;d++){var e=Math.abs(a-this.ea.links[d].dir);e<b&&(b=e,c=d)}d=c==this.ea.links.length-1?0:c+1;e=this.ea.links[d].dir;if(e<this.ea.links[c].dir&&(e=Math.abs(a-(e+360)),e<b))return d;d=0==c?this.ea.links.length-1:c-1;e=this.ea.links[d].dir;return e>this.ea.links[c].dir&&(e=Math.abs(360+a-e),e<b)?d:c},NQ:function(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[2]-b[2],2))},vA:function(){var a=this.oe,b=this.jb;a.Qt=b.getUniformLocation(a, "uPMatrix");a.Nt=b.getUniformLocation(a,"uMVMatrix");a.alpha=b.getUniformLocation(a,"uAlpha");a.color=b.getUniformLocation(a,"uColor");a=this.wv;a.Qt=b.getUniformLocation(a,"uPMatrix");a.Nt=b.getUniformLocation(a,"uMVMatrix");a.XZ=b.getUniformLocation(a,"uSampler")},wA:function(){var a=this.oe,b=this.jb;a.En=b.getAttribLocation(a,"aVertexPosition");a=this.wv;a.En=b.getAttribLocation(a,"aVertexPosition");a.Fu=b.getAttribLocation(a,"aVertexTextureCoord")},LB:function(){var a=this.oe,b=this.jb;b.uniformMatrix4fv(a.Qt, q,this.Wh);b.uniformMatrix4fv(a.Nt,q,this.lB)},va:t(),setData:function(a){if(this.ea=a)this.Ud={},this.zR=this.ea.tiles.dirNorth,this.Pa=o},Tv:function(a,b,c,d){this.jb&&(this.Pa&&this.ea)&&(this.jb.useProgram(this.oe),this.Wh=a,this.lB=b,this.Dr=c,this.BT=d,this.LB(),this.Ab())},Ab:function(){if(this.Wh&&this.lB){var a=this.XT(),b=this.jb,c=this.oe,d=this.wv;b.depthMask(q);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);var e=this.ww;e.zE();e.Yo(c.En);e.cD();this.Tl&&(c=0.6,5>this.vH&&(c=0.2),this.Zq(this.pH.vc, this.pH.$D(),this.Un,1,c,q),this.Zq(this.jJ.vc,this.jJ.$D(),this.Un,1,c+0.3,q));if(!(this.iI||this.$j===q)){var c=a[0],f=a[1],g=a[2],i=a[3],k=a[4],l=a[5],a=a[6];b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);b.activeTexture(b.TEXTURE2);b.useProgram(d);e.zE();e.Yo(d.En);e.Yo(d.Fu);e.cD();b.uniformMatrix4fv(d.Qt,q,this.Wh);b.uniformMatrix4fv(d.Nt,q,this.lB);b.uniform1i(d.XZ,2);this.On&&(b.bindTexture(b.TEXTURE_2D,this.On),this.Zq(c,i,p,1,1,o,k));this.Qn&&(b.bindTexture(b.TEXTURE_2D, this.Qn),this.Zq(f,i,p,1,1,o,k));this.Pn&&(b.bindTexture(b.TEXTURE_2D,this.Pn),this.Zq(g,l,p,1,1,o,a));b.depthMask(o)}}},XT:function(){for(var a=[],b=[],c=[],d=[],e=[],f=tk.length/3,g=this.P.Fa().heading+this.zR;0>g;)g+=360;var i=this.P.Fa().pitch,g=20,k=-30,l=this.wo.cj||this.P.ga(),g=g+20*l;0>i&&(i=Math.abs(i),g*=(90-i)/90,k-=20*i/90);for(i=0;i<this.ea.links.length;i++){var m=this.ea.links[i],n=Math.cos(Pb(m.zh))*g,s=Math.sin(Pb(m.zh))*g,l=Sj.create();Sj.Qm(l);Sj.rotate(l,l,Pb(m.zh-90),[0,1,0]); for(var m=[n,k,s],n=tk,s=vk,u=0;u<f;u++){var w=this.lH(l,n,3*u);a.push(w[0]+m[0],m[1]-1,w[2]+m[2]);b.push(w[0]+m[0],m[1],w[2]+m[2]);w=this.lH(l,s,3*u);c.push(w[0]+m[0],m[1],w[2]+m[2])}}f=this.LQ(d,[],e,[]);return this.lT=a=[a,b,c,d,f[0],e,f[1]]},LQ:function(a,b,c,d){for(var e=0;e<this.ea.links.length;e++){var f=4*e;a.push(f,f+1,f+2);a.push(f,f+2,f+3);c.push(f,f+1,f+3);c.push(f+2,f+3,f+1);b=b.concat(uk);d=d.concat(this.oS(this.ea.links[e].dir))}return[b,d]},lH:function(a,b,c){return[a[0]*b[c]+a[1]* b[c+1]+a[2]*b[c+2],0,a[8]*b[c]+a[9]*b[c+1]+a[10]*b[c+2]]},Zq:function(a,b,c,d,e,f,g){var i=this.jb,k=this.oe;f&&(k=this.wv);var l=[0,0,0],m=[];if(c){l[0]=c[0];l[2]=c[2];for(var n=0;n<a.length/3;n++){var s=3*n;m.push(a[s]+l[0],c[1],a[s+2]+l[2])}}else m=a;f?(this.Yl||(this.Yl=i.createBuffer()),i.bindBuffer(i.ARRAY_BUFFER,this.Yl),i.bufferData(i.ARRAY_BUFFER,new Float32Array(g),i.STATIC_DRAW),i.vertexAttribPointer(k.Fu,2,i.FLOAT,q,0,0)):(i.uniform1f(k.color,d),i.uniform1f(k.alpha,e));this.yI||(this.yI= i.createBuffer());i.bindBuffer(i.ARRAY_BUFFER,this.yI);i.bufferData(i.ARRAY_BUFFER,new Float32Array(m),i.STATIC_DRAW);this.Ev||(this.Ev=i.createBuffer());i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.Ev);i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),i.STATIC_DRAW);this.Ev.mG=b.length;i.vertexAttribPointer(k.En,3,i.FLOAT,q,0,0);i.drawElements(i.TRIANGLES,this.Ev.mG,i.UNSIGNED_SHORT,0)},ir:function(a,b){var c=this.Dr,d=this.BT;if(c){var e=a[0],f=a[1],g=this.dj,i=this.Yj,k=Rj.create(),e=Rj.tg(2* e/g-1,1-2*f/i,-1,1);Sj.multiply(k,c,e);Sj.multiply(k,d,k);c=200*k[0];d=200*k[1];k=200*k[2];e=(b||-20)/d;if(!(0>e))return[c*e,d*e,k*e]}},Qk:function(){this.dj=this.Xa.width;this.Yj=this.Xa.height},oS:function(a){var b=Math.ceil(Math.floor((a+360)%360/22.5)/2);8===b&&(b=0);for(var a=wk.slice(0),c=Math.floor(b/2),b=b%2,d=0;d<a.length;d++)a[d]=0==d%2?a[d]+0.25*c:a[d]+0.5*b;return a},VV:function(){this.Ud={}},show:function(){this.$j=o},U:function(){this.$j=q},vD:function(){this.ao=o},$C:function(){this.ao= q},VC:function(){this.VV();var a=this.jb;a.deleteTexture(this.On);a.deleteTexture(this.Qn);a.deleteTexture(this.Pn);this.Pn=this.Qn=this.On=p}}); ');
